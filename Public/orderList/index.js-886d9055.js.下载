!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("React"),require("ReactDOM"),require("Q"),require("logger"),require("_")):"function"==typeof define&&define.amd?define("pages/pc/index",["React","ReactDOM","Q","logger","_"],t):"object"==typeof exports?exports["pages/pc/index"]=t(require("React"),require("ReactDOM"),require("Q"),require("logger"),require("_")):e["pages/pc/index"]=t(e.React,e.ReactDOM,e.Q,e.logger,e._)}(this,function(e,t,n,o,r){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var r=n(1),i=o(r),s=n(2),a=o(s),u=n(3),c=o(u),l=n(4),f=o(l),d=n(45),p=o(d),h=n(6),g=n(11),m=o(g),v=n(10),y=o(v),_=n(26),b=o(_);(0,h.on)("open").then(function(e){var t=c["default"].io.opts.curTransport;return m["default"].set("trans",t),"proxy"===t?m["default"].set("logger",!1):(m["default"].set("logger",!0),void y["default"].elog("016100002",{time:e}))}),(0,h.on)("error").then(function(e,t){"socket-error"===e&&y["default"].elog("016100003",{code:t.code,uid:m["default"].get("loginUserId")})}),window._imStart=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data||{},n=y["default"].getDomain();return document.body.className=n,t.user_id?void(0,h.init)(e).then(function(e){b["default"].send(JSON.stringify({code:1007,data:null})),a["default"].render(i["default"].createElement(f["default"],{data:t}),document.getElementById("imContainer"));var n=c["default"].io.opts.curTransport,o=void 0;switch(n){case"ws":o="016100004";break;case"poll":o="016100028";break;case"proxy":o="016100031"}y["default"].elog(o,{time:e.countTime}),console.log(e)})["catch"](function(e){a["default"].render(i["default"].createElement(p["default"],{data:"IM\u65e0\u6cd5\u8fde\u63a5\u6210\u529f\uff01",showBtn:!0}),document.getElementById("imContainer")),b["default"].send(JSON.stringify({code:1007,data:null}));var t=c["default"].io.opts.curTransport,n=void 0;switch(t){case"ws":n="016100005";break;case"poll":n="016100029";break;case"proxy":n="016100030"}y["default"].elog(n,{uid:m["default"].get("loginUserId"),code:e.result_code}),console.error(e)}):void a["default"].render(i["default"].createElement(p["default"],null),document.getElementById("imContainer"))}},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(4),i=o(r),s=n(3),a=o(s),u=n(6),c=o(u),l=n(2),f=o(l),d=n(12),p=o(d),h=null;h||(h=new p["default"],h.util=a["default"],h.ajax=c["default"],h.debug=f["default"],h.event=i["default"]),t["default"]=h,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={ws:"@MGIM_WS",DEVTRANSPORT:"@MGIM_DEV_PORT",CROSSTAB:"@MGIM_CROSSTAB",DEBUGKEY:"@MGIM:*",DEV:"@MGIM_DEV_ON",noAckReq:["hb","reportErr"],noAckPush:["userKicked","msgReaded","cinfoNotify","userStateNotify"],legalTrans:["ws","proxy","poll"],close:{4001:"proxy login timeout",4002:"socket notify proxy reconnect",4003:"proxy login fail max times",4101:"socket login conflict, change to proxy",4200:"client close poll",4201:"poll failed 3 times, app stop",4202:"poll need re login ,app stop",4203:"poll got a unkown code, app stop",4204:"poll login got wrong code, app stop",4205:"poll login ajax error, app stop",4300:"client need change transport, just destroy old conn",4304:"socket page is unload",4301:"client choose to close, app stop",4302:"network browken, app stop",4400:"net reconn fail 3 times"}},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(7),s=o(i),a=n(1),u=o(a);String.prototype.repeat||(String.prototype.repeat=function(e){if(null==this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,e!=e&&(e=0),0>e)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="";1==(1&e)&&(n+=t),e>>>=1,0!=e;)t+=t;return n});var c=function(){return window.localStorage&&"on"===localStorage[u["default"].DEV]},l=function(e){return e.map(function(e){return"object"===("undefined"==typeof e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e))),e})};t["default"]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u["default"].DEBUGKEY;e=e.length<15?""+e+"*".repeat(15-e.length):e;var t=function(){for(var t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];c()&&(0,s["default"])(e).apply(void 0,l(n))},n=function(){for(var e,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];c()&&(e=console).info.apply(e,l(n))},o=function(){for(var e,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];c()&&(e=console).warn.apply(e,l(n))},r=function(){for(var e,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];c()&&(e=console).error.apply(e,l(n))};return{log:t,info:n,warn:o,error:r}},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(1),s=o(i),a=(new Date).getTime(),u=parseInt(1e3*Math.random()+23),c=parseInt(1e3*Math.random()+23),l=a*Math.pow(2,10)+u,f=a*Math.pow(2,10)+c,d=function(e){return function(t){console.log("\u9ed8\u8ba4%s\u56de\u8c03, %o",e,t)}};t["default"]={now:function(){function e(){return(new Date).getTime()+(window.MGIM_Toffset||0)}return e}(),uuid:function(){function e(){var e=this.getSession(s["default"].UUID);if(e)return e;var t=this.now();return e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0,o="x"===e?n:3&n|8;return o.toString(16)})}return e}(),getRequestId:function(){function e(){return""+ ++f}return e}(),getClientMsgId:function(){function e(){return""+ ++l}return e}(),isArray:function(){function e(e){return"[object Array]"===toString.call(e)}return e}(),isPlainObject:function(){function e(e){if(!e||"object"!==("undefined"==typeof e?"undefined":r(e)))return!1;var t="function"==typeof e.constructor?Object.getPrototypeOf(e):Object.prototype;if(null===t)return!0;var n=t.constructor;return"function"==typeof n}return e}(),isFunction:function(){function e(e){return"[object Function]"===toString.call(e)}return e}(),each:function(){function e(e,t){for(var n=0;n<e.length;n++)t(n,e[n])}return e}(),on:function(){function e(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){var t=window.event;t.target=t.srcElement,t.currentTarget=e,n.call(e,t)}),e}return e}(),off:function(){function e(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n),e}return e}(),checkStorage:function(){function e(){return!!(window.localStorage&&window.sessionStorage&&window.StorageEvent)}return e}(),checkSocket:function(){function e(){return!(!window.WebSocket&&!window.MozWebSocket)}return e}(),getStore:function(){function e(e,t){if(!this.checkStorage())return null;var n=null;return"local"===e&&(n=localStorage.getItem(t)),"session"===e&&(n=sessionStorage.getItem(t)),this.parseData(n)}return e}(),mixin:function(){function e(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}return e}(),setStore:function(){function e(e,t,n){if(this.checkStorage()){var o=this.stringifyData(n);e="local"===e?localStorage:sessionStorage,e.setItem(t,o)}}return e}(),getStorage:function(){function e(e){return this.getStore("local",e)}return e}(),setStorage:function(){function e(e,t){return this.setStore("local",e,t)}return e}(),getSession:function(){function e(e){return this.getStore("session",e)}return e}(),setSession:function(){function e(e,t){return this.setStore("session",e,t)}return e}(),storagePush:function(){function e(e,t){var n=this.getStorage(e)||[];n.push(t),this.setStorage(e,n)}return e}(),storageSlice:function(){function e(e,t){var n=this.getStorage(e)||[];n.find(function(e,n,o){e===t&&o.splice(n,1)}),this.setStorage(e,n)}return e}(),toggleLog:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s["default"].DEBUGKEY;e===!1&&(e="",localStorage.setItem(s["default"].DEV,"")),localStorage.setItem("debug",e)}return e}(),togglePoll:function(){function e(){var e="poll";arguments&&arguments[0]===!1&&(e=""),localStorage.setItem("@MGIM_DEV_PORT",e)}return e}(),getCb:function(){function e(e){var t=e.success||d("success"),n=e.fail||d("fail");return delete e.success,delete e.fail,[t,n]}return e}(),arr2Json:function(){function e(e,t){var n={};return e&&e.length>0&&e.forEach(function(e){n[e[t]]=e}),n}return e}(),json2Arr:function(){function e(e){return Object.keys(e).map(function(t){return e[t]})}return e}(),parseData:function(){function e(e){if(e&&"string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}return e}(),stringifyData:function(){function e(e){return e&&"object"===("undefined"==typeof e?"undefined":r(e))&&(e=JSON.stringify(e)),e}return e}()},e.exports=t["default"]},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function r(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],s(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,u=0;r>u;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,s,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,r=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(4),u=o(a),c=n(2),l=o(c),f=n(11),d=o(f),p=n(1),h=(0,l["default"])("@MGIM:TRANSPORT"),g=function(){},m=function(e){function t(n){r(this,t);var o=i(this,e.call(this));return o.opts=n,o.loginCache={},o.errTimes=0,o.tabEmit=(0,d["default"])(p.CROSSTAB),o.opts.proxy?o.tabEmit.on("sendMsgSync",function(e){o.emit("sendMsgSync",e)}):(o.tabEmit.emit=g,o.tabEmit.on=g,o.tabEmit.removeAllListeners=g),o.opts.supportHost&&"proxy"!==o.opts.curTransport&&o._onProxy(),o}return s(t,e),t.prototype._onProxy=function(){function e(){var e=this;h.log("listen msg from proxy ..."),this.tabEmit.on("loginReq",function(t){h.log("proxy need to login, send resp %o",e.loginCache),e.opts.hasProxy=!0,-1===e.opts.proxyTabs.indexOf(t)&&e.opts.proxyTabs.push(t),e.tabEmit.emit("loginResp",e.loginCache)}),this.tabEmit.on("send",function(t){h.log("proxy need to send msg: %o",t),e.send(t)})}return e}(),t}(u["default"]);t["default"]=m,e.exports=t["default"]},function(e,t){"use strict";function n(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return window.alert("\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301AJAX\uff01"),!1}}return e}function o(e){var t="",n=[],r="";if(arguments&&"string"==typeof arguments[1]&&(r=t=arguments[1]),arguments&&arguments[2]instanceof Array&&(n=arguments[2]),"object"===("undefined"==typeof e?"undefined":p(e)))for(var i in e)if(t=r,"object"!==p(e[i])){i=encodeURIComponent(i);var s=encodeURIComponent(e[i]);n.push(""===t?i+"="+s:t+"["+i+"]="+s)}else t=""===t?i:t+"["+i+"]",o(e[i],t,n);return n.join("&").replace(/%20/g,"+")}function r(e){var t={type:"GET",url:"",data:"",processData:!0,dataType:"text",contentType:"application/x-www-form-urlencoded",async:!0,success:function(){function e(){console.log("ajax success")}return e}(),error:function(){function e(){console.warn("ajax fail")}return e}(),timeout:0,jsonp:"callback",jsonpCallback:""};return t=d({},t,e),t.dataType=t.dataType.toUpperCase(),t.type=t.type.toUpperCase(),t.timeout=Number(t.timeout),t.processData&&"object"===p(e.data)&&(t.data=o(e.data)),t}function i(e,t){var n="timeout";t.timer=setTimeout(function(){e.abort(),t.error(e,n,n)},t.timeout)}function s(e){var t=e.type,o=e.url,r=e.data,s=e.async,a=e.contentType,u=n();return u.onreadystatechange=function(){g(u,e)},0!==e.timeout&&"number"==typeof e.timeout&&i(u,e),"GET"===t?(r&&(-1!==o.indexOf("?")?"?"===o[o.length-1]?o+=r:o=o+"&"+r:o=o+"?"+r),u.open(t,o,s),u.send(null)):"POST"===t&&(u.open(t,o,s),a!==!1&&u.setRequestHeader("content-type",a||"application/x-www-form-urlencoded"),u.send(r)),u}function a(e,t){var n=e.url,o=e.jsonp,r=e.data,i=o+"="+t,s=-1!==n.indexOf("?")?"?"===n[n.length-1]?"":"&":"?";return r?""+n+s+r+"&"+i:""+n+s+i}function u(e){var t="jQuery_"+(new Date).getTime()+e;return window[t]?(h++,u(h)):t}function c(e){return e.jsonpCallback?e.jsonpCallback:u(h)}function l(e){function t(){i.parentNode&&i.parentNode.removeChild(i),window[n]=null,s&&clearTimeout(s)}var n=c(e),o=a(e,n),r=document.getElementsByTagName("script")[0]||document.head,i=void 0,s=void 0;return 0!==e.timeout&&"number"==typeof e.timeout&&(s=setTimeout(function(){t(),e.error({statusText:"timeout",readyState:0,status:0},"timeout","timeout")},e.timeout)),window[n]=function(n){e.success(n),e.jsonpCallback&&"function"==typeof window[e.jsonpCallback]&&window[e.jsonpCallback](n),t()},i=document.createElement("script"),i.type="text/javascript",i.onerror=function(t){return e.error(t,"error","error"),!0},i.src=o,r.parentNode.insertBefore(i,r),{abort:t}}function f(e){var t=r(e);return"JSONP"!==t.dataType?s(t):l(t)}t.__esModule=!0;var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=0,g=function(e,t){var n=t.success,o=t.dataType,r=t.error;if(4===e.readyState){if(200===e.status&&"function"==typeof n)switch(o){case"XML":n(e.responseXML);break;default:try{var i=JSON.parse(e.responseText);n(i)}catch(t){n(e.responseText)}}else r(e,"error",e.status);window.clearTimeout(t.timer)}};t["default"]=f,e.exports=t["default"]},function(e,t,n){(function(o){function r(){return!("undefined"==typeof window||!window||"undefined"==typeof window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,o)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function u(){try{return t.storage.debug}catch(e){}return"undefined"!=typeof o&&"env"in o?o.env.DEBUG:void 0}function c(){try{return window.localStorage}catch(e){}}t=e.exports=n(8),t.log=s,t.formatArgs=i,t.save=a,t.load=u,t.useColors=r,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(u())}).call(t,n(19))},function(e,t,n){function o(e){var n,o=0;for(n in e)o=(o<<5)-o+e.charCodeAt(n),o|=0;return t.colors[Math.abs(o)%t.colors.length]}function r(e){function n(){if(n.enabled){var e=n,o=+new Date,r=o-(c||o);e.diff=r,e.prev=c,e.curr=o,c=o;for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(n,o){if("%%"===n)return n;a++;var r=t.formatters[o];if("function"==typeof r){var s=i[a];n=r.call(e,s),i.splice(a,1),a--}return n}),t.formatArgs.call(e,i);var u=n.log||t.log||console.log.bind(console);u.apply(e,i)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=o(e),"function"==typeof t.init&&t.init(n),n}function i(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),o=n.length,r=0;o>r;r++)n[r]&&(e=n[r].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function s(){t.enable("")}function a(e){var n,o;for(n=0,o=t.skips.length;o>n;n++)if(t.skips[n].test(e))return!1;for(n=0,o=t.names.length;o>n;n++)if(t.names[n].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=r.debug=r["default"]=r,t.coerce=u,t.disable=s,t.enable=i,t.enabled=a,t.humanize=n(18),t.names=[],t.skips=[],t.formatters={};var c},function(e,t){"use strict";t.__esModule=!0,t["default"]={request:{getAccessServer:"2#1",login:"2#3",logout:"2#5",syncTime:"2#8",getLoginState:"2#10",kickOther:"2#12",getConvList:"3#1",updateConv:"3#3",fetchConv:"3#5",createConv:"3#7",delConv:"3#9",operateConv:"3#11",getLastMsg:"3#15",getUnreadCnt:"3#17",getAllUnreadCnt:"3#19",createGroup:"4#1",delGroup:"4#3",updateGroup:"4#5",getGroupInfo:"4#7",addGroupMem:"4#9",delGroupMem:"4#11",getApplier:"4#13",operateApplier:"4#15",operateAdmin:"4#17",transferOwner:"4#31",getGroupSimple:"4#35",getGroupMember:"4#37",sendMsg:"5#1",getHistoryMsg:"5#5",msgRead:"5#7",modifyMsg:"5#9",sendP2pMsg:"6#1",p2pMsg:"6#3",getOnLineState:"7#2",setOnLineState:"7#4",getUserInfo:"7#6",monitorState:"7#8",unmonitorState:"7#10",getStateMonitor:"7#12",getCinfoCnt:"8#1",hb:"10#1",reportErr:"8#2",echo:"8#3",forward:"8#4",transmit:"12#1",getService:"14#1",switchService:"14#3",destroyService:"14#5",getLastService:"14#7",bizSwitchService:"17#1"},push:{"2#7":"userKicked","2#14":"stateChanged","3#13":"convUpdated","4#19":"groupDeled","4#21":"groupUpdated","4#23":"memberAdded","4#25":"memberDeled","4#27":"adminChaned","4#29":"applierOperated","4#33":"ownerTransfered","5#3":"message","5#11":"msgReaded","6#3":"getP2pMsg","7#1":"userStateNotify","8#3":"cinfoNotify","12#3":"transmit"}},e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0,t["default"]={pacConfig:{onlineState:1,langType:"zh-CN",appVersion:"710",packageVersion:300,reserved:"0",biz_type:1},queueConfig:{resendTimes:3,factor:2,minTimeout:6e3,maxTimeout:3e4,queueCycle:100},netConfig:{transports:["ws","poll"],proxy:!1,protocols:"dumb-increment-protocol",heartbeat:3e4,pollCycle:6e3,reConnectMaxTimes:3,ws:"ws://221.228.199.52:843",poll:"http://221.228.199.52:18008"},logConfig:{log:!1,key:"MGIM:*"}},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=new s.EventEmitter,n=t.emit;return t.emit=function(){var t=[].slice.call(arguments);localStorage.setItem(e,JSON.stringify(t)),localStorage.removeItem(e)},u["default"].on(window,"storage",function(e){if(e.key===r&&e.newValue){var o=e.newValue;try{o=JSON.parse(o)}catch(r){}n.apply(t,o)}}),t}function i(e){return e="tab_emit_"+(e||""),c[e]||(c[e]=r(e)),c[e]}t.__esModule=!0,t["default"]=i;var s=n(4),a=n(3),u=o(a),c={};e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(4),c=n(14),l=o(c),f=n(10),d=o(f),p=n(1),h=n(9),g=o(h),m=n(13),v=o(m),y=n(3),_=o(y),b=n(2),w=o(b),T=(0,w["default"])("@MGIM:MSG"),C=function(e){function t(){r(this,t);var n=i(this,e.call(this));return n.io=null,n.isIniting=!1,n.opts=d["default"],n._bindReqFunc(),n}return s(t,e),t.prototype.config=function(){function e(e){if(!this.io&&!this.isIniting&&e){for(var t in e){var n=this.opts[t],o=e[t];for(var r in o)n.hasOwnProperty(r)&&(n[r]=o[r])}T.log("user config %o",this.opts),this.opts.logConfig.log?_["default"].toggleLog(this.opts.logConfig.key):"on"===_["default"].getStorage(p.DEV)?_["default"].toggleLog():_["default"].toggleLog(!1)}}return e}(),t.prototype.init=function(){function e(e){var t=this;!this.isIniting&&e&&(this.isIniting=!0,T.log("start to init..."),this.initCbs=_["default"].getCb(e),this.io=new l["default"](this.opts.netConfig),this._initIoEvent(),this.opts.queueConfig.cb=function(e){t.io.send(e)},this.queue=new v["default"](this.opts.queueConfig),this.reconnect=0,this.opts.loginParam=e.data,this.isIniting=!1)}return e}(),t.prototype.stop=function(){function e(e){T.log("client choose to close conn %s",e),this.io.stop(e)}return e}(),t.prototype._initIoEvent=function(){function e(){var e=this;this.io.on("open",function(t){e.emit("open",t),T.log("conn success, start to login..."),e._login()}),this.io.on("loginOk",function(t,n){if(t&&0===t.result_code){var o=t.server_time-_["default"].now();return window.MGIM_Toffset=Math.abs(o)>1e3?o:0,T.log("login success %o",t),e.queue.start(),e._wsHeartBeat(),e.reconnect++,e.initCbs[0](a(t,{countTime:n})),e.reconnect>1&&e.emit("reconnect"),void e.request("syncTime",{data:{client_time:""+_["default"].now()},success:function(){function e(e){var t=_["default"].now(),n=e.data.server_time-e.data.client_time-parseInt((t-e.data.client_time)/2);window.MGIM_Toffset=Math.abs(n)>1e3?n:0,T.log("timestamp sync (%d) ",window.MGIM_Toffset)}return e}()})}T.log("login fail %o",t),e.initCbs[1](t)}),this.io.on("stopQueue",function(){e.queue.stop()}),this.io.on("error",function(t,n){e.emit("error",t,n)}),this.io.on("appStop",function(t){e.emit("appStop",t)}),this.io.on("sendMsgSync",function(t){e.emit("sendMsgSync",t)}),this.io.on("offline",function(t){e.emit("offline",t)}),this.io.on("online",function(t){e.emit("online",t)}),this.io.on("message",function(t){var n=t.request_id,o=e.queue.reqCb[n];if(delete e.queue.reqCb[n],o){var r=e.queue.store[n];return delete e.queue.store[n],r&&t.command_id===r.command_id?(o[1](t),void T.error("server pasre json to pb error %o",t)):0===t.data.result||0===t.data.result_code?(T.log("this is a success resp %o",t),void o[0](t)):(T.log("this is a fail resp %o",t),void o[1](t))}e.io.opts.hasProxy&&(T.log("host forward msg to proxy %o",t),e.io.conn.tabEmit.emit("message",t));var i=e.pushMap(t);if(i&&i.type){var s=i.type,a=i.ackData;T.log("this is a server push %s",s),e.emit(s,t),"proxy"!==e.io.opts.curTransport&&-1===p.noAckPush.indexOf(s)&&(T.log("ack for server push %o",a),e.io.send(a))}})}return e}(),t.prototype._wsHeartBeat=function(){function e(){"ws"===this.io.opts.curTransport&&(this.request("hb",{}),this.io.opts.hbid=window.setTimeout(this._wsHeartBeat.bind(this),3e4))}return e}(),t.prototype._login=function(){function e(){var e=this.requestMap("login",this.opts.loginParam);this.io.login(e)}return e}(),t.prototype._bindReqFunc=function(){function e(){var e=this,t=g["default"].request;Object.keys(t).forEach(function(t){e[t]=function(n){return e.request(t,n)}})}return e}(),t.prototype.pushMap=function(){function e(e){var t=g["default"].push[e.module_id+"#"+e.command_id];if(t){var n={module_id:e.module_id,command_id:e.command_id+1,request_id:_["default"].getRequestId(),biz_type:e.biz_type||this.opts.pacConfig.biz_type,version:e.version||this.opts.pacConfig.packageVersion,reserved:e.reserved||this.opts.pacConfig.reserved};return"message"===t&&(n.server_message_id=e.data.message.server_message_id),{type:t,ackData:n}}}return e}(),t.prototype.requestMap=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=g["default"].request[e];return n?(n=n.split("#"),{module_id:Number(n[0]),command_id:Number(n[1]),biz_type:this.opts.pacConfig.biz_type,data:t,request_id:_["default"].getRequestId(),version:this.opts.pacConfig.packageVersion,reserved:this.opts.pacConfig.reserved}):void 0}return e}(),t.prototype.request=function(){function e(e,t){var n=this;T.log("request %s, param: %o",e,t);var o=_["default"].getCb(t),r=this.requestMap(e,t.data);if(!r)return void o[1]("please check your key and data!");var i=r.request_id;return this.queue.reqCb[i]=o,arguments[3]===!0||-1!==p.noAckReq.indexOf(e)?void this.io.send(r):(this.queue.push(r),"sendMsg"!==e||!this.io.opts.hasProxy&&"proxy"!==this.io.opts.curTransport||(T.log("send msg sync %o",t),this.io.conn.tabEmit.emit("sendMsgSync",t)),{abort:function(){function e(){return T.log("try to abort a req %s",i),void 0!==i&&n.queue.slice(i)}return e}()})}return e}(),t}(u.EventEmitter);t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(4),u=o(a),c=n(3),l=o(c),f=n(2),d=o(f),p=(0,d["default"])("@MGIM:QUEUE"),h=function(e){p.log("%o",e)},g=function(e){function t(n){r(this,t);var o=i(this,e.call(this));return o.opts=n,o.status=0,o.store={},o.reqCb={},o.opts.cb=o.opts.cb&&"function"==typeof o.opts.cb?o.opts.cb:h,o}return s(t,e),t.prototype.start=function(){function e(){p.log("queue start..."),this.status=1,this.startTimer()}return e}(),t.prototype.startTimer=function(){function e(){1===this.status&&(this.timer=setTimeout(this.handleStore.bind(this),this.opts.queueCycle))}return e}(),t.prototype.stop=function(){function e(){p.log("queue stop"),this.status=0,window.clearTimeout(this.timerId)}return e}(),t.prototype.pause=function(){function e(){this.status=2,window.clearTimeout(this.timer)}return e}(),t.prototype.push=function(){function e(e){2===this.status&&this.start(),this.store[e.request_id]={reqPac:e,retry:0,now:0,waitCycle:0},p.log("push in queue %o",this.store[e.request_id])}return e}(),t.prototype.slice=function(){function e(e){return!!this.store[e]&&(p.log("slice from queue %o",this.store[e]),delete this.store[e])}return e}(),t.prototype.handleStore=function(){function e(){if(0===Object.keys(this.store).length)return p.log("queue is clear, stop"),void this.pause();var e=l["default"].now();for(var t in this.store){var n=this.store[t];n.retry>=this.opts.resendTimes?(p.error("queue send %o fail %d times, del it!",n.reqPac,n.retry),delete this.store[t],this.reqCb[t][1]({msg:"send Msg fail Max times",
data:n.reqPac})):e-n.now>=n.waitCycle&&(this.opts.cb(n.reqPac),n.retry++,n.now=e,n.waitCycle=this._getTimeout(n.retry))}this.startTimer()}return e}(),t.prototype._getTimeout=function(){function e(e){var t=Math.round(this.opts.minTimeout*Math.pow(this.opts.factor,e));return Math.min(t,this.opts.maxTimeout)}return e}(),t}(u["default"]);t["default"]=g,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(4),u=o(a),c=n(3),l=o(c),f=n(2),d=o(f),p=n(1),h=o(p),g=n(17),m=o(g),v=n(15),y=o(v),_=n(16),b=o(_),w=(0,d["default"])("@MGIM:NET"),T={ws:m["default"],proxy:b["default"],poll:y["default"]},C=function(e){function t(n){r(this,t);var o=i(this,e.call(this));return o.reconnTimes=0,o.opts=n,o.opts.supportWs=o._checkHardWare(),o.opts.supportHost=o.opts.supportWs&&o.opts.proxy,o.opts.hasProxy=!1,o.opts.proxyTabs=[],o.opts.uuid=l["default"].uuid(),w.log("cur page uuid (%s)",o.opts.uuid),o._initWindowEvent(),o._setTransport(),o._connect(),o}return s(t,e),t.prototype._checkHardWare=function(){function e(){return l["default"].checkStorage()&&l["default"].checkSocket()}return e}(),t.prototype._setTransport=function(){function e(e){if(!this.opts.supportWs)return w.log("ws or ls not support, choose (poll)"),this.opts.curTransport="poll";if(e&&-1!==h["default"].legalTrans.indexOf(e))return w.log("set transport param, choose (%s)",e),this.opts.curTransport=e;var t=l["default"].getStorage(h["default"].DEVTRANSPORT);if(-1!==h["default"].legalTrans.indexOf(t))return w.log("localStorage dev transport, choose (%s)",t),this.opts.curTransport=t;var n=l["default"].getStorage(h["default"].ws);return this.opts.proxy&&n&&n!==this.opts.uuid?(w.log("read ls ws (%s)",n),w.log("sdk config allow proxy, and another ws is working\uff0cchoose (proxy)"),this.opts.curTransport="proxy"):(this.opts.curTransport=this.opts.transports.shift()||"poll",void w.log("auto set\uff0cchoose (%s)",this.opts.curTransport))}return e}(),t.prototype._connect=function(){function e(){this.opts.supportHost&&"proxy"!==this.opts.curTransport&&l["default"].setStorage(h["default"].ws,this.opts.uuid),this.opts.url=this.opts[this.opts.curTransport];try{w.log("new connection..."),this.conn=new T[this.opts.curTransport](this.opts)}catch(e){return w.error("new connection got a error %o",e),this._reconn()}this._initConnEvent()}return e}(),t.prototype._initWindowEvent=function(){function e(){var e=this;l["default"].on(window,"beforeunload",function(){l["default"].getStorage(h["default"].ws)===e.opts.uuid&&(l["default"].setStorage(h["default"].ws,""),e.conn.tabEmit.emit("reconnect","ws"),e.stop(4304))}),l["default"].on(window,"offline",function(){w.error("network is offline"),e.emit("offline"),e.stop(4302)}),l["default"].on(window,"online",function(){w.warn("network is connected again"),e.emit("online"),e._reconn(e.opts.curTransport)})}return e}(),t.prototype._initConnEvent=function(){function e(){var e=this;w.log("listen conn events..."),this.conn.on("open",function(t){e.reconnTimes=0,e.emit("open",t)}),this.conn.on("loginOk",function(t,n){t=l["default"].parseData(t),w.log("got login resp %o",t),e.emit("loginOk",t,n)}),this.conn.on("message",function(t){t=l["default"].parseData(t),w.log("got msg %o",t),e.emit("message",t)}),this.conn.on("error",function(t,n){w.error("got conn error: %o",n),e.emit("error",t,n)}),this.conn.on("appStop",function(t){e.emit("appStop",t)}),this.conn.on("reconnect",function(t){e._reconn(t)}),this.conn.on("sendMsgSync",function(t){e.emit("sendMsgSync",t)})}return e}(),t.prototype._reconn=function(){function e(e){return++this.reconnTimes>2?(w.error("reconn fail 3 times, will stop!"),this.stop(4400)):void(window.navigator.onLine&&(w.log("reconnecting... (%s)",e),this.conn.tabEmit.removeAllListeners(),this.conn.removeAllListeners(),this._setTransport(e),this._connect()))}return e}(),t.prototype.login=function(){function e(e){e.data.client_type||(e.data.client_type="poll"===this.opts.curTransport?7:3),w.log("send a login req: %o",e),this.conn.login(e)}return e}(),t.prototype.stop=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4301;window.clearTimeout(this.opts.hbid),this.emit("stopQueue"),this.conn.close(e)}return e}(),t.prototype.send=function(){function e(e){e&&(w.log("send a msg %o",e),this.conn.send(l["default"].stringifyData(e)))}return e}(),t}(u["default"]);t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(5),c=o(u),l=n(1),f=o(l),d=n(3),p=o(d),h=n(6),g=o(h),m=n(2),v=o(m),y=(0,v["default"])("@MGIM:POLL"),_={dataType:"jsonp",type:"GET"},b={result_code:0,online_state:1,server_time:""+p["default"].now()},w=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.isPolling=!1,o.aborted=!1,o._connect(),o}return s(t,e),t.prototype._connect=function(){function e(){setTimeout(this._notifyOpen.bind(this),0)}return e}(),t.prototype._notifyOpen=function(){function e(){this.emit("open")}return e}(),t.prototype._startPoll=function(){function e(){var e=this;if(!this.isPolling&&!this.aborted){if(++this.errTimes>2)return this.close(4201);this.isPolling=!0,this.poll=(0,g["default"])(a({url:this.opts.url+"/im/poll",timeout:0,success:function(){function t(t){return e.isPolling=!1,e.errTimes=0,5===t.code?e.close(4202):0===t.code&&t.data?(e.emit("message",t.data),e._startPoll()):6===t.code?e._startPoll():void e.close(4203)}return t}(),error:function(){function t(t,n){return e.isPolling=!1,"timeout"===n?e._startPoll():(y.error("poll got a error %o",t),e.errTimes++,void e._startPoll())}return t}()},_))}}return e}(),t.prototype.login=function(){function e(e){var t=this;(0,g["default"])(a({url:this.opts.url+"/im/login",timeout:this.opts.pollCycle,data:{param:p["default"].stringifyData(e)},success:function(){function e(e){if(!e||4!==e.code&&0!==e.code)return t.close(4204);var n=void 0;return e&&4===e.code&&(n=b),e&&0===e.code&&(n=e.data?p["default"].parseData(e.data).data:b,t.loginCache.loginfo=n),t._startPoll(),t.emit("loginOk",n)}return e}(),error:function(){function e(e){y.log("poll login ajax error: %o",e),t.close(4205)}return e}()},_))}return e}(),t.prototype.send=function(){function e(e){var t=this;e&&(0,g["default"])(a({url:this.opts.url+"/im/request",timeout:this.opts.pollCycle,data:{param:e},success:function(){function e(e){return 5===e.code?t.close(4202):0!==e.code?y.error("poll ajax send error: %o",e):void 0}return e}(),error:function(){function e(e){y.error("poll ajax got error: %o",e)}return e}()},_))}return e}(),t.prototype.close=function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4200,t=f["default"].close[""+e]||"";return y.error("poll start to close: %d %s",e,t),this.poll&&(this.poll.abort(),this.isPolling=!1,this.aborted=!0,delete this.poll),this.opts.hasProxy&&this.tabEmit.emit("reconnect"),4200!==e?(this.emit("appStop",e),void(this.opts.supportHost&&this.tabEmit.removeAllListeners())):void this.emit("reconnect")}return e}(),t}(c["default"]);t["default"]=w,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(5),u=o(a),c=n(1),l=o(c),f=n(2),d=o(f),p=n(3),h=o(p),g=(0,d["default"])("@MGIM:PROXY"),m=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.openTimer=null,o._listenHost(),o._connect(),o}return s(t,e),t.prototype._connect=function(){function e(){setTimeout(this._notifyOpen.bind(this),0)}return e}(),t.prototype._notifyOpen=function(){function e(){this.emit("open")}return e}(),t.prototype._listenHost=function(){function e(){var e=this;this.tabEmit.on("loginResp",function(t,n){if(g.log("got login resp from ws %o %o",t,n),window.clearTimeout(e.openTimer),t&&(!e.loginCache.id||e.loginCache.id!==t.id)){if(t.loginfo)return e.errTimes=0,e.emit("loginOk",t.loginfo);g.log("proxy login fail %o",t),setTimeout(e.login.bind(e),500)}}),this.tabEmit.on("message",function(t){g.log("proxy got msg: %o",t),e.emit("message",t)}),this.tabEmit.on("reconnect",function(t){e.close(4002,t)})}return e}(),t.prototype.login=function(){function e(){var e=this;return++this.errTimes>3?this.close(4003,"ws"):(g.log("send a login req to ws %s",this.opts.uuid),this.tabEmit.emit("loginReq",this.opts.uuid),void(this.openTimer=window.setTimeout(function(){h["default"].setStorage(l["default"].ws,""),e.close(4001)},500)))}return e}(),t.prototype.send=function(){function e(e){this.tabEmit.emit("send",e)}return e}(),t.prototype.close=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ws",n=l["default"].close[""+e]||"";g.error("proxy start to close... %d %s",e,n),this.emit("reconnect",t)}return e}(),t}(u["default"]);t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(5),u=o(a),c=n(3),l=o(c),f=n(1),d=o(f),p=n(2),h=o(p),g=(0,h["default"])("@MGIM:SOCKET"),m=window.WebSocket||window.MozWebSocket,v=function(){return(new Date).getTime()},y=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o._connect(),o}return s(t,e),t.prototype._connect=function(){function e(){var e=this;this._startT=v(),this.ws=new m(this.opts.url,this.opts.protocols),this.ws.onopen=function(t){e._open(t)},this.ws.onmessage=function(t){e._message(t)},this.ws.onerror=function(t){e._error(t)},this.ws.onclose=function(t){e._onclose(t)}}return e}(),t.prototype._open=function(){function e(){this.emit("open",v()-this._startT)}return e}(),t.prototype._message=function(){function e(e){var t=l["default"].parseData(e.data);return this.loginCache.id===t.request_id?(this.loginCache.loginfo=t.data,this.emit("loginOk",this.loginCache.loginfo,v()-this._loginStartT)):void this.emit("message",t)}return e}(),t.prototype._error=function(){function e(e){this.emit("error","socket-error",e)}return e}(),t.prototype._onclose=function(){function e(e){if(l["default"].getStorage(d["default"].ws)===this.opts.uuid&&l["default"].setStorage(d["default"].ws,""),e.code&&e.reason===d["default"].close[e.code])switch(g.error("ws closed because %s %s",e.code,e.reason),e.code){case 4101:this.emit("reconnect","proxy");break;case 4300:this.emit("reconnect");break;case 4301:this.emit("appStop",e.code);break;case 4302:window.navigator.onLine||this.emit("appStop",e.code)}else g.log("ws closed because server reason %o",e),this.emit("reconnect","poll"),this.opts.hasProxy&&this.tabEmit.emit("reconnect","proxy")}return e}(),t.prototype.login=function(){function e(e){var t=l["default"].getStorage(d["default"].ws);return g.log("read ls exist ws (%s)",t),this.opts.supportHost&&t!==this.opts.uuid?this.close(4101):(this.loginCache.id=e.request_id,void this.send(e))}return e}(),t.prototype.send=function(){function e(e){e&&this.ws&&1===this.ws.readyState&&(this._loginStartT=v(),this.ws.send(l["default"].stringifyData(e)))}return e}(),t.prototype.close=function(){function e(e){var t=d["default"].close[""+e]||"";this.ws&&1===this.ws.readyState&&this.ws.close(e,t)}return e}(),t}(u["default"]);t["default"]=y,e.exports=t["default"]},function(e,t){function n(e){if(e=String(e),!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),o=(t[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function o(e){return e>=c?Math.round(e/c)+"d":e>=u?Math.round(e/u)+"h":e>=a?Math.round(e/a)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function r(e){return i(e,c,"day")||i(e,u,"hour")||i(e,a,"minute")||i(e,s,"second")||e+" ms"}function i(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,a=60*s,u=60*a,c=24*u,l=365.25*c;e.exports=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return n(e);if("number"===i&&isNaN(e)===!1)return t["long"]?r(e):o(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){g&&p&&(g=!1,p.length?h=p.concat(h):m=-1,h.length&&a())}function a(){if(!g){var e=r(s);g=!0;for(var t=h.length;t;){for(p=h,h=[];++m<t;)p&&p[m].run();m=-1,t=h.length}p=null,g=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(e){f=o}}();var p,h=[],g=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new u(e,t)),1!==h.length||g||r(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}}])})},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=n(1),l=o(c),f=n(5),d=o(f),p=n(27),h=o(p),g=n(6),m=n(10),v=o(m),y=n(11),_=o(y),b=n(43),w=o(b),T=n(14),C=o(T),E=n(44),M=o(E),x=n(26),S=o(x),O=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.parseUrl=function(e){var t=e.convId,n=e.groupId,r=e.userId,i=e.goodsId;if(t)console.log("-----change to conv----",t),o.changeToConv(t),o.refs.userlist.cleanUnreadCnt(t);else if(n)console.log("-----change to group----",n),o.parseGroup(n);else if(r){var s=r;console.log("-----got userid, start to new conv-----",s),o.assignSvr(s,i)}else{if(C["default"].isEmpty(e))return o.changeToConv(-1);v["default"].redirect("",!0)}},o.listenEvent=function(){(0,g.on)("message").then(function(e){S["default"].send(JSON.stringify({code:1008,data:null}));var t=e.data.message,n=t.conversation_id;o.renderMsg(n,t)}),(0,g.on)("sendMsgSync").then(function(e){S["default"].send(JSON.stringify({code:1008,data:null}));var t=e.data.message,n=t.conversation_id;o.renderMsg(n,t)}),(0,g.p2pMsg)("rateScore",function(e){var t=e.conversation_id;o.renderMsg(t,e)}),(0,g.on)("groupUpdated").then(function(e){console.error(e)}),(0,g.on)("reconnect").then(function(){var e=o.refs,t=e.room,n=e.userlist;n&&setTimeout(function(){n.fetchConvList(!0)},0),t&&setTimeout(function(){t.refreshHistory()},0)}),(0,g.on)("userKicked").then(function(){v["default"].showToast("\u60a8\u7684\u8d26\u53f7\u5df2\u7ecf\u5728\u5176\u4ed6\u7f51\u9875\u767b\u9646...\u8bf7\u5237\u65b0\u9875\u9762\uff01"),(0,g.stop)()}),(0,g.on)("offline").then(function(){v["default"].showToast("\u7f51\u7edc\u8fde\u63a5\u5df2\u65ad\u5f00\uff01")}),(0,g.on)("online").then(function(){v["default"].showToast("\u7f51\u7edc\u8fde\u63a5\u5df2\u6062\u590d\uff0c\u91cd\u65b0\u8fde\u63a5\u4e2d...")}),(0,g.on)("convUpdated").then(function(e){var t=e.data.conversation;if(t){var n=o.refs.userlist.state.convList,r=C["default"].findIndex(n,function(e){return e.conversation_id===t.conversation_id});if(-1!==r){var i=v["default"].parseConvStatus(t.conversation_status).isDelete;i?n.splice(r,1):n[r]=u(n[r],t),o.refs.userlist.setState({convList:n}),(0,g.updateConvList)(n),i&&o.state.activeConvId===t.conversation_id&&v["default"].redirect("",!0)}}}),(0,g.on)("memberAdded").then(function(e){var t=o.refs.userlist.state.convList,n=e.data.group_id,r=C["default"].findIndex(t,function(e){return e.entity_id===n});if(-1===r)return void(0,g.getGroups)([n]).then(function(e){if("object"===("undefined"==typeof e?"undefined":a(e))){var r=e[n];3===r.status&&(0,g.createConv)(n,2).then(function(e){e&&e.conversation_id||console.error("create group conv fail"),o.refs.userlist.setState({convList:t.push(e)})})}});var i=t[r].conversation_id;(0,g.getUser)(e.data.user_id).then(function(e){var t=C["default"].map(e,function(e){return e.name||""});t=t.join(",");var n={sender_id:_["default"].get("loginUserId"),conversation_id:i,timestamp:""+v["default"].sdkUtil.now(),client_message_id:v["default"].sdkUtil.getClientMsgId(),message_type:-2,message_content:t+"\u52a0\u5165\u7fa4\u5566"};o.renderMsg(i,n)})}),(0,g.on)("memberDeled").then(function(e){var t=o.refs.userlist.state.convList,n=C["default"].findIndex(t,function(t){return t.entity_id===e.data.group_id});if(-1!==n){var r=t[n].conversation_id;return-1!==C["default"].indexOf(e.data.user_id,_["default"].get("loginUserId"))?(t.splice(n,1),(0,g.updateConvList)(t),o.refs.userlist.setState({convList:t}),void(r===o.state.activeConvId&&v["default"].redirect("",!0))):void(0,g.getUser)(e.data.user_id).then(function(e){var t=C["default"].map(e,function(e){return e.name||""});t=t.join(",");var n={sender_id:_["default"].get("loginUserId"),conversation_id:r,timestamp:""+v["default"].sdkUtil.now(),client_message_id:v["default"].sdkUtil.getClientMsgId(),message_type:-2,message_content:t+"\u9000\u51fa\u4e86\u7fa4"};o.renderMsg(r,n)})}}),(0,g.on)("groupDeled").then(function(e){var t=o.refs.userlist.state.convList,n=C["default"].findIndex(t,function(t){return t.entity_id===e.data.group_id});if(-1!==n){var r=t[n].conversation_id;t.splice(n,1),(0,g.updateConvList)(t),o.refs.userlist.setState({convList:t}),o.state.activeConvId===r&&v["default"].redirect("",!0)}}),(0,g.on)("msgReaded").then(function(e){o.notifyUserList(e.data.conversation_id)})},o.notifyUserList=function(e){o.refs&&o.refs.userlist&&o.refs.userlist.cleanUnreadCnt(e)},o.topConv=function(e,t){o.changeToConv(e,!0);var n=o.refs.userlist;n&&n.receiveMsg(e,t)},o.state={activeConvId:"",activeConv:{},activeGroup:null,topActiveConv:!1},o.goods={},o.listenEvent(),o}return s(t,e),t.prototype.componentDidMount=function(){function e(){var e=this;window.onhashchange=function(){v["default"].plog(),(0,w["default"])(e.parseUrl)},(0,w["default"])(this.parseUrl)}return e}(),t.prototype.changeToConv=function(){function e(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(-1===e)return void this.setState({activeConv:{},activeConvId:""});if(e){var r=this.state.activeConv;(r.conversation_id!==e||n||o)&&(0,g.getConvs)([e],o,{withoutLastMsg:!0}).then(function(r){var i=r[0];if(!i||!i.name)return v["default"].redirect(),void console.error("convid is not valid");if(o){var s=t.refs.userlist.state.convList;s.push(i),t.refs.userlist.setState({convList:s})}try{t.setState({activeConv:i,activeConvId:e,topActiveConv:n})}catch(a){t.setState({activeConv:i,activeConvId:e,topActiveConv:n})}})["catch"](function(e){console.error("can not find conv by convid",e),v["default"].redirect()})}}return e}(),t.prototype.parseGroup=function(){function e(e){var t=this,n=e;(0,g.getGroups)([n]).then(function(e){if("object"===("undefined"==typeof e?"undefined":a(e))){var o=e[n];3===o.status?(0,g.createConv)(n,2,{withoutLastMsg:!0}).then(function(e){return e&&e.conversation_id?void v["default"].redirect("convId="+e.conversation_id):(v["default"].showToast("\u521b\u5efa\u7fa4\u4f1a\u8bdd\u5931\u8d25"),v["default"].redirect())})["catch"](function(){v["default"].redirect()}):t.setState({activeGroup:o})}})}return e}(),t.prototype.assignSvr=function(){function e(e,t){var n=this,o=v["default"].now();(0,g.createConv)(e).then(function(r){if(!r||!r.conversation_id)return v["default"].showToast("\u5206\u914d\u5ba2\u670d\u5931\u8d25\uff01"),v["default"].elog("016100007",{toid:e,tid:"",uid:_["default"].get("loginUserId"),code:""}),void v["default"].redirect();v["default"].elog("016100006",{time:v["default"].now()-o}),console.log("-----create conv success-----",r);var i=r.conversation_id;t&&(n.goods={gId:t,shopId:r.shopId,convId:i}),n.changeToConv(i,!0,!0),v["default"].redirect("convId="+i,!0)})["catch"](function(t){v["default"].elog("016100007",{toid:e,tid:"",uid:_["default"].get("loginUserId"),code:t.data.ressult}),v["default"].redirect()})}return e}(),t.prototype.renderMsg=function(){function e(e,t){var n=this.refs,o=n.room,r=n.userlist;o&&o.receiveMsg(e,t),r&&r.receiveMsg(e,t)}return e}(),t.prototype.render=function(){function e(){var e=this.state,t=e.activeConvId,n=e.activeConv,o=e.activeGroup,r=e.topActiveConv,i=this.goods,s=l["default"].createElement(M["default"],{activeConv:n,activeConvId:t}),a=l["default"].createElement(h["default"],{ref:"room",activeGroup:o,activeConvId:t,activeConv:n,goods:i,notifyUserList:this.notifyUserList,topConv:this.topConv});return l["default"].createElement("div",{className:"wrap"},s,l["default"].createElement("div",{className:"chat-body"},l["default"].createElement(d["default"],{ref:"userlist",activeConvId:t,activeConv:n,topActiveConv:r}),l["default"].createElement("div",{className:"chat-main"},a)))}return e}(),t}(c.Component);O.propTypes={children:c.PropTypes.any},t["default"]=O,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(6),l=n(2),f=n(23),d=o(f),p=n(25),h=o(p),g=n(10),m=o(g),v=n(11),y=o(v),_=n(14),b=o(_),w=n(8),T=o(w),C=n(26),E=o(C),M=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.scrollHandle=function(e){var t=e.currentTarget||(0,l.findDOMNode)(o);t.scrollTop>t.scrollHeight-2*t.clientHeight&&o.fetchConvList()},o.mousewheelHandle=function(e){var t=e.wheelDelta||-e.detail;if(t=Math.max(-1,Math.min(1,t)),1===t){var n=(0,l.findDOMNode)(o);n.clientHeight===n.scrollHeight&&o.fetchConvList(),m["default"].sdkUtil.off(n,"mousewheel",o.mousewheelHandle)}},o.cleanUnreadCnt=function(e){var t=o.state.convList,n=b["default"].findIndex(t,function(t){return t.conversation_id===e});if(-1!==n){var r=t[n].unread_count;(0,c.request)("msgRead",{conversation_id:e}).then(function(){E["default"].send(JSON.stringify({code:1008,data:null}))}),r>0&&(t[n].unread_count=0,o.setState({convList:t}))}},o.onConvDel=function(e){var t=m["default"].now();(0,c.request)("delConv",{conversation_id:e}).then(function(){m["default"].elog("016100021",{time:m["default"].now()-t})})["catch"](function(t){m["default"].elog("016100022",{code:t.data.result,uid:y["default"].get("loginUserId"),convid:e})});var n=o.state.convList;n=b["default"].filter(n,function(t){return t.conversation_id!==e}),o.setState({convList:n}),(0,c.updateConvList)(n),e===o.props.activeConvId&&m["default"].redirect("",!0)},o.onUserActive=function(e){var t=o.props.activeConvId;t!==e&&m["default"].redirect("convId="+e)},o.state={convList:[],loginUserId:y["default"].get("loginUserId")},o.lock=!1,o}return s(t,e),t.prototype.componentDidMount=function(){function e(){this.fetchConvList();var e=(0,l.findDOMNode)(this);m["default"].sdkUtil.on(e,"scroll",b["default"].throttle(this.scrollHandle,80)),m["default"].sdkUtil.on(e,"mousewheel",this.scrollHandle)}return e}(),t.prototype.componentWillReceiveProps=function(){function e(e){var t=e.activeConvId,n=e.topActiveConv,o=this.state.convList;if(t&&(t!==this.props.activeConvId||n)&&n){var r=b["default"].sortBy(o,function(e){return e.conversation_id===t?0:1});this.setState({convList:r})}}return e}(),t.prototype.componentWillUnmount=function(){function e(){var e=(0,l.findDOMNode)(this);m["default"].sdkUtil.off(e,"mousewheel",this.scrollHandle)}return e}(),t.prototype.fetchConvList=function(){function e(e){var t=this;if(!this.end&&!this.lock){this.lock=!0,console.log("-----start to get conv list-------");var n=m["default"].now();(0,c.getConvList)({withoutLastMsg:!0,refresh:e}).then(function(e){m["default"].elog("016100017",{time:m["default"].now()-n}),t.lock=!1;var o=t.state.convList,r=e.length;(r>=200||r===o.length)&&(t.end=!0),o=e;var i=t.props,s=i.activeConvId,a=i.topActiveConv;a&&(o=b["default"].sortBy(o,function(e){return e.conversation_id===s?0:1})),console.log("-----get conv list success-------",o),t.setState({convList:o})})["catch"](function(e){m["default"].elog("016100018",{uid:y["default"].get("loginUserId"),code:e.data.result})})}}return e}(),t.prototype.getAConv=function(){function e(e){var t=this,n=this.state.convList,o=!0;return T["default"].promise(function(r,i){var s=b["default"].find(n,function(t){return t.conversation_id===e});return s&&(o=!1,r([s,o])),"string"==typeof e&&(e=[e]),(0,c.getConvs)(e,!1,{withoutLastMsg:!0}).then(function(e){n=b["default"].union(n,e),t.setState({convList:n}),r([e[0],o])})["catch"](function(e){console.error("fetch conv fail",e),i(e)})})}return e}(),t.prototype.renderList=function(){function e(){var e=this,t=this.props.activeConvId,n=this.state.convList,o=[];return n=b["default"].sortBy(n,function(e){return m["default"].parseConvStatus(e.conversation_status).isTop?0:1}),b["default"].map(n,function(n){if(!n||!n.name)return!1;var r=n.conversation_id,i=n.entity_id,s={title:n.name,userId:i,Badges:n.unread_count};return o.push(u["default"].createElement(d["default"],{data:s,key:"li-"+r,id:r,focus:r===t,active:e.onUserActive,closeCb:e.onConvDel})),!0}),o}return e}(),t.prototype.receiveMsg=function(){function e(e,t){var n=this,o=this.props.activeConvId;this.getAConv(e).then(function(r){var i=r[0],s=r[1];s||o===e||t.sender_id===n.state.loginUserId||m["default"].parseConvStatus(i.conversation_status).isMute||i.unread_count++,i.lastMsg=t,i.update_time=t.timestamp;var a=n.state.convList,u=b["default"].sortBy(a,function(t){return m["default"].parseConvStatus(t.conversation_status).isTop?0:t.conversation_id===e?1:t.conversation_id===o?2:3});n.setState({convList:u})})}return e}(),t.prototype.render=function(){function e(){return u["default"].createElement("div",{className:"chat-left"},u["default"].createElement(h["default"],null,this.renderList()))}return e}(),t}(u["default"].Component);M.propTypes={children:u["default"].PropTypes.any,activeConvId:u["default"].PropTypes.string,topActiveConv:u["default"].PropTypes.bool,className:u["default"].PropTypes.string},t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(7),i=n(15),s=o(i),a=n(17),u=o(a),c=n(18),l=n(16),f=o(l),d=n(19),p=o(d),h=n(21),g=o(h),m=n(22),v=o(m);t["default"]={init:s["default"],on:r.on,request:r.request,stop:r.stop,getEmoji:f["default"],ajax:r.ajax,updateConvList:c.updateConvList,getConvList:c.getConvList,getConvs:c.getConvs,getGroups:p["default"],getGoods:v["default"],getConvByUserId:c.getConvByUserId,getConvByConvId:c.getConvByConvId,p2pMsg:g["default"],createConv:c.createConv,getUser:u["default"],rateScore:r.rateScore},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(8),i=o(r),s=n(3),a=o(s),u=n(9),c=o(u),l=n(14),f=o(l),d=function(e){return function(t){var n=i["default"].defer(),o=t;return o.success=function(e){return n.resolve(e)},o.fail=function(e){return n.reject(e)},e(o),n.promise}};t["default"]={config:function(){function e(e){e=f["default"].extend({},e),a["default"].config(e)}return e}(),init:function(){function e(e){return d(function(e){a["default"].init(e)})({data:e})}return e}(),stop:function(){function e(e){return a["default"].stop(e)}return e}(),getUserInfo:function(){function e(e){
console.log("----start to get userInfo------",e);var t={url:c["default"].getUrl("imApi")+"/user/users_avatar",data:{userIds:e.join(",")},type:"GET",dataType:"jsonp",jsonp:"callback"};return d(function(e){a["default"].ajax(e)})(t)}return e}(),on:function(){function e(e){return{then:function(){function t(t){a["default"].on(e,function(){t.apply(void 0,arguments)})}return t}()}}return e}(),request:function(){function e(e,t){return d(function(t){a["default"].request(e,t)})({data:t})}return e}(),ajax:function(){function e(e){return d(function(e){a["default"].ajax(e)})(e)}return e}(),rateScore:function(){function e(e,t,n){var o={url:c["default"].getUrl("imApi")+"/action/do",data:{loginId:e,id:t,score:n},type:"GET",dataType:"jsonp",jsonp:"callback"};return d(function(e){a["default"].ajax(e)})(o)}return e}()},e.exports=t["default"]},function(e,t){e.exports=n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(10),i=o(r),s=i["default"].getDomain(),a=void 0,u=function(e){if(!s||!a){s=i["default"].getDomain();var t="//imapi."+s+".com",n="//webim."+s+".com";a={imApi:t,webim:n,goodsApi:"//imapi."+s+".com/goods/currentGoods",faceGroup:t+"/phiz/group",faceList:t+"/phiz/list",imageUrl:"//media."+s+".com/image/put?appKey=126",goodsUrl:"mogujie"===s?"//shop.mogujie.com/detail/":"//item.meilishuo.com/detail/"}}return a[e]};t["default"]={getUrl:function(){function e(e){return u(e)}return e}(),convSize:20,historySize:20,firstHistory:5,diffTime:6e4,title:"\u7f8e\u4e3d\u8bf4IM",offcial:["123h8zw","12i3cl8","1wh5vpq","1vnm0pe","14qp42w","14qp5u6"]},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(3),i=n(11),s=o(i),a=n(12),u=o(a),c=n(13),l=o(c),f=l["default"].newNotice(),d=navigator.userAgent,p=function(e){var t=e?new Date(Number(e)):new Date;return{y:t.getFullYear(),m:t.getMonth()+1,d:t.getDate(),h:t.getHours(),i:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()}},h=function(e){var t=e?new Date(Number(e)):new Date,n=["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u65e5"];return"\u661f\u671f"+n[t.getDay()]},g=function(e){return Number(e)>9?""+e:"0"+e},m=function(){var e=s["default"].get("platform");return e?e:(e=/mogujie.com/.test(window.location.hostname)?/pc|mtalk\/imv2/.test(window.location.pathname)?"mgjpc":"mgjh5":/pc/.test(window.location.pathname)?"mlspc":"mlsh5",s["default"].set("platform",e),e)},v=function(){return s["default"].get("trans")};t["default"]={isQQBrowser:!!/qq\/(\d\.\d)/i.test(d),isWeChat:!!/micromessenger/i.test(d),isHttps:0===location.href.indexOf("https"),queryString:function(){function e(e){var t=this;"string"!=typeof e&&(e=window.location.search),e=e.replace(/^[\?#]/g,"");var n={};return e?(e.split("&").forEach(function(e){var o=e.split("="),r=o[0],i=o[1];r&&i&&(n[r]=t.escapeHtml(i))}),n):n}return e}(),dayTime:function(){function e(e,t){var n=p(),o=p(e);if(n.Y===o.Y){if(n.m===o.m){if(n.d===o.d)return this.formtTime(e,"hh:ii");if(n.d-o.d===1)return t?"\u6628\u5929":this.formtTime(e,"\u6628\u5929 hh:ii");if(n.d-o.d<=7){var r=h(e);return t?r:r+" "+this.formtTime(e,"hh:ii")}}if(1===n.d&&n.m-o.m===1){var i=new Date;if(i=new Date(i.setDate(i.getDate()-1)).getDate(),o.d===i)return t?"\u6628\u5929":this.formtTime(e,"\u6628\u5929 hh:ii");if(o.d>=i-6){var s=h(e);return t?s:s+" "+this.formtTime(e,"hh:ii")}}}return t?this.formtTime(e,"y/m/d"):this.formtTime(e,"y/m/d hh:ii")}return e}(),formtTime:function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Y-m-d H:i:s",n=p(e);return t.replace(/hh/gi,g(n.h)).replace(/ii/gi,g(n.i)).replace(/ss/gi,g(n.s)).replace(/y/gi,n.y%100).replace(/m/gi,n.m).replace(/d/gi,n.d).replace(/h/gi,n.h).replace(/i/gi,n.i).replace(/s/gi,n.s)}return e}(),escapeHtml:function(){function e(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;").replace(/'/g,"&#039;")}return e}(),idToUrl:function(){function e(e,t){if(t||(t=1),"string"==typeof e&&24===e.length)return e;if(e instanceof Array){for(var n=0;n<e.length;n++){var o=e[n];e[n]=this.idtourl(o)}return e}if(parseInt(e,10)>0){var r=void 0;switch(t){case 1:r=t+parseInt(""+(2*e+56),10).toString(36);break;default:r=!1}return r}return e}return e}(),urlToId:function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(24===e.length&&e.match(/^[0-9a-f]+$/))return e;if(e instanceof Array){for(var n=0;n<e.length;n++){var o=e[n];e[n]=this.urlToId(o)}return e}if(e.indexOf(",")>0){e=e.split(",");for(var r=0;r<e.length;r++){var i=e[r];i?e[r]=this.urltoid(i):delete e[r]}return e.join(",")}if(t&&e.match(/^(null|undefined)$/i))return!1;var s=parseInt(e.substr(0,1),10),a=void 0;switch(s){case 1:a=(parseInt(parseInt(""+e.substr(1),36).toString(10),10)-56)/2;break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a=0;break;default:a=e}return a>0?parseInt(a,10):0}return e}(),divCursorToEnd:function(){function e(e){if(e)if(window.getSelection){e.focus();var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}else if(document.selection){var n=document.selection.createRange();n.moveToElementText(e),n.collapse(!1),n.select()}}return e}(),getDomain:function(){function e(){var e=s["default"].get("domain");return e?e:-1!==window.location.hostname.search("mogujie.com")?"mogujie":-1!==window.location.hostname.search("meilishuo.com")?"meilishuo":(console.error("domain is both not mogujie or meilishuo!!"),"")}return e}(),now:function(){function e(){return(new Date).getTime()}return e}(),elog:function(){function e(e,t){s["default"].get("logger")!==!1&&(t.platform=m()+v(),window.logger&&u["default"].log(e,t))}return e}(),plog:function(){function e(){window.logger&&u["default"].refreshPevent()}return e}(),redirect:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var n=window.location.href.replace(/(javascript:|#).*$/,"");return window.location.replace(n+"#"+e)}window.location.hash="#"+e}return e}(),showToast:function(){function e(e){e&&f.show(e)}return e}(),parseConvStatus:function(){function e(e){return e=e.toString(2).split("").reverse(),{isTop:parseInt(e[0],10),isForbid:parseInt(e[1],10),isMute:parseInt(e[2],10),isDelete:parseInt(e[31],10)}}return e}(),sdkUtil:r.util},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(3),i=o(r),s="161008",a="MEILIIM__"+s+"__",u={};t["default"]={set:function(){function e(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(u[e]=t,n){var o=a+e.toUpperCase();i["default"].util.setStorage(o,t)}return!0}return e}(),get:function(){function e(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&(!u||!u[e])){var n=a+e.toUpperCase();u[e]=i["default"].util.getStorage(n)}return u[e]||null}return e}()},e.exports=t["default"]},function(e,t){e.exports=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(2),l=o(c),f=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.show=function(e,t){setTimeout(o.hide,t||o.state.duration),o.setState({content:e,show:!0})},o.hide=function(){o.setState({content:"",show:!1})},o.state={type:"primary",content:"",show:!1,duration:3e3},o}return s(t,e),t.prototype.render=function(){function e(){var e=this.state,t=e.type,n=e.content,o=e.show,r={display:o?"block":"none"},i=["toast",t];return i=i.join(" "),u["default"].createElement("div",{className:i,style:r},u["default"].createElement("span",null,n))}return e}(),t}(u["default"].Component);f.newNotice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=document.createElement("div");document.body.appendChild(t);var n=l["default"].render(u["default"].createElement(f,e),t);return{show:function(){function e(e){n.show(e)}return e}()}},t["default"]=f,e.exports=t["default"]},function(e,t){e.exports=r},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(7),i=o(r),s=n(11),a=o(s),u=n(16),c=o(u),l=n(10),f=o(l);t["default"]=function(e){var t=e.data||{},n={app_id:t.app_id,signature:t.signature,noce:t.noce,token:t.token,device_id:t.device_id||"",user_id:t.user_id,timestamp:t.timestamp.toString(),app_version:"300",online_state:1,from_site:8};return t.sign&&(n.sign=t.sign),f["default"].isQQBrowser?a["default"].set("client_type",12):f["default"].isWeChat&&a["default"].set("client_type",11),a["default"].set("domain",e.domain,!0),a["default"].set("loginUserId",t.user_id),(0,c["default"])(),i["default"].config({logConfig:{log:!1,key:"@MGIM:*"},netConfig:{proxy:!0,ws:e.wsUrl,poll:e.pollUrl},queueConfig:{queueCycle:10}}),i["default"].init(n)},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(7),i=o(r),s=n(10),a=o(s),u=n(11),c=o(u),l=n(9),f=o(l),d=a["default"].getDomain(),p=c["default"].get(d+"__emji");t["default"]=function(){if(p)return p;var e="meilishuo"===d?19:0;return i["default"].ajax({url:f["default"].getUrl("faceList"),data:{groupId:e},type:"GET",dataType:"jsonp",jsonp:"callback"}).then(function(e){if(e&&e.status&&1001===e.status.code){var t=e.result;p={},t.forEach(function(e){p[e.tag]=e}),c["default"].set(d+"__emji",p,!0)}}),[]},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(8),i=o(r),s=n(7),a=n(14),u=o(a),c=n(11),l=o(c),f=n(10),d=o(f),p={},h=function(e){var t=[],n={};return u["default"].map(e,function(e){p[e]?n[e]=p[e]:t.push(e)}),{leftUserIds:t,haveUsers:n}};t["default"]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i["default"].promise(function(t,n){e.length||t({});var o=h(e),r=o.leftUserIds,i=o.haveUsers;if(!r.length)return void t(i);var a=d["default"].now();(0,s.getUserInfo)(r).then(function(e){d["default"].elog("016100023",{time:d["default"].now()-a}),console.log("----get user info resp----",e);var n={};u["default"].map(e.result,function(e){n[e.userId]={entity_id:e.userId,entity_type:1,avatar:e.avatar,shopId:e.shopId,name:e.name}}),p=u["default"].extend(p,n),t(u["default"].extend(i,n))})["catch"](function(t){d["default"].elog("016100024",{uid:l["default"].get("loginUserId"),code:t.data.result,userid:JSON.stringify(e)}),n(t)})})},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(7),i=n(17),s=o(i),a=n(19),u=o(a),c=n(9),l=o(c),f=n(20),d=n(8),p=o(d),h=n(10),g=o(h),m=n(14),v=o(m),y=void 0,_=[],b={maxTime:"0",minTime:"0",count:l["default"].convSize},w=function(e){var t=[],n=[],o=[],r=g["default"].sdkUtil.now(),i=v["default"].chain(e).sortBy(function(e){return-e.update_time}).filter(function(e){var i=parseInt(e.update_time,10);return r>=i&&(r=i),-1===v["default"].indexOf(o,e.conversation_id)&&!g["default"].parseConvStatus(e.conversation_status).isDelete&&(1===e.entity_type||3===e.entity_type?t.push(e.entity_id):2===e.entity_type&&n.push(e.entity_id),o.push(e.conversation_id),!0)}).value();return{time:r,convs:i,users:t,groups:n,allid:o}},T=function(e,t){return v["default"].map(e,function(e){var n=t[e.entity_id];return n?v["default"].extend(e,n):e})},C=function(e,t){return v["default"].map(e,function(e){for(var n=0;n<t.length;n++){var o=t[n];if(e.conversation_id===o.conversation_id)return t.splice(n,1),v["default"].extend(e,{last_message:o.message,lastMsg:(0,f.formatLastMsg)(o.message)})}return v["default"].extend(e,{last_message:null,lastMsg:" "})})},E=function(e,t){return v["default"].map(e,function(e){for(var n=0;n<t.length;n++){var o=t[n];if(e.conversation_id===o.conversation_id)return t.splice(n,1),v["default"].extend(e,{unread_count:o.unread_count})}return v["default"].extend(e,{unread_count:0})})},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=w(e),o=n.time,i=n.users,a=n.groups,c=n.allid,l=w(e),f=l.convs;y=o;var d=0;return i.length>0&&d++,a.length>0&&d++,t.withoutUnread||d++,t.withoutLastMsg||d++,p["default"].promise(function(e,n){c.length<=0&&e([]),i.length>0&&(0,s["default"])(i).then(function(t){f=T(f,t),0===--d&&e(f)},function(e){n(e)}),a.length>0&&(0,u["default"])(a).then(function(t){f=T(f,t),0===--d&&e(f)},function(t){console.error("get user info error",t),f=T(f,[]),0===--d&&e(f)}),!t.withoutLastMsg&&c.length>0&&(0,r.request)("getLastMsg",{conversation_id:c}).then(function(t){f=C(f,t.data.last_message),0===--d&&e(f)},function(t){console.error("get last msg error",t),f=C(f,[]),0===--d&&e(f)}),!t.withoutUnread&&c.length>0&&(0,r.request)("getUnreadCnt",{conversation_id:c}).then(function(t){f=E(f,t.data.unread_count),0===--d&&e(f)},function(t){console.error("get unread cnt error",t),f=E(f,[]),0===--d&&e(f)})})};t["default"]={getConvList:function(){function e(e){return y&&!e.refresh||(y=g["default"].sdkUtil.now()),b.maxTime=""+y,(0,r.request)("getConvList",b).then(function(t){var n=t.data.conversation;return M(n,e).then(function(t){return _=e.refresh?t.concat(_):_.concat(t),_=v["default"].uniq(_,!1,function(e){return e.conversation_id}),v["default"].clone(_)})})["catch"](function(e){return e})}return e}(),getConvs:function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments[2];return p["default"].Promise(function(o,i){var s=[];return t||(s=v["default"].filter(_,function(t){return v["default"].indexOf(e,t.conversation_id)>=0&&(e=v["default"].without(e,t.conversation_id),!0)}),0!==e.length)?(0,r.request)("fetchConv",{conversation_id:e}).then(function(e){var t=e.data.conversation;return M(t,n).then(function(e){return _=v["default"].union(_,e),o(v["default"].union(s,e))})["catch"](function(e){return i(e)})})["catch"](function(e){return i(e)}):o(s)})}return e}(),getConvByUserId:function(){function e(e){return v["default"].find(_,function(t){return t.entity_id===e})}return e}(),getConvByConvId:function(){function e(e){return v["default"].find(_,function(t){return t.conversation_id===e})}return e}(),createConv:function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2];return(0,r.request)("createConv",{entity:[{entity_type:t,entity_id:e}]}).then(function(e){var t=e.data.conversation;return M(t,n).then(function(e){return _=v["default"].union(_,e),e[0]})})["catch"](function(e){return console.error("creat conv fail",e),e})}return e}(),updateConvList:function(){function e(e){_=e}return e}()},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(8),i=o(r),s=n(7),a=n(14),u=o(a),c={},l=function(e){var t=[],n={};return u["default"].map(e,function(e){c[e]?n[e]=c[e]:t.push(e)}),{leftGids:t,haveGroups:n}};t["default"]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i["default"].promise(function(t,n){if(!e.length)return t({});var o=l(e),r=o.leftGids,i=o.haveGroups;return r.length?(0,s.request)("getGroupSimple",{group_id:r}).then(function(e){var n={};return u["default"].map(e.data.group,function(e){n[e.group_id]=u["default"].extend(e,{entity_id:e.group_id,entity_type:2,avatar:e.group_avatar,name:e.group_name})}),c=u["default"].extend(c,n),t(u["default"].extend(i,n))})["catch"](function(e){return n(e)}):t(i)})},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0,t.parseMsg=t.formatLastMsg=t.formatMsg=void 0;var r=n(10),i=o(r),s=n(14),a=o(s),u=n(16),c=o(u),l=/&\$#@~\^@\[{:(.*?(?!&\$#@~\^@\[{:)):}]&\$~@#@/i,f=/^https?:\/\/.*(jpg|png|gif)$/i,d=/(\[[a-zA-Z0-9_\u4e00-\u9fa5]*\])/gi,p=function(e){return JSON.parse(e).text||""},h=function(e){var t=JSON.parse(e)||{};return t.url?"&$#@~^@[{:"+t.url+":}]&$~@#@":""},g=function(e){var t=JSON.parse(e)||{};return JSON.stringify({emotionGroup:t.groupId,emotionTag:t.tag,url:t.url})},m=function(e){var t=JSON.parse(e)||{},n="";return a["default"].map(t,function(e){switch(e.itemtype){case 1:return void(n+=e.text);case 2:return void(n+="&$#@~^@[{:"+e.url+":}]&$~@#@");case 3:var t=e.url||"http://imapi.mogujie.com/phiz/index?groupId="+e.groupid+"&tag="+e.tag;return void(n+="&$#@~^@[{:"+t+":}]&$~@#@");default:return}}),n},v=function(e){var t=JSON.parse(e);return t.type=7,JSON.stringify(t)},y=function(e){if("meilishuo"===i["default"].getDomain())return e;var t=e.message_content,n=e.message_type;switch(n){case 501:e.message_type=1,e.message_content=p(t);break;case 502:e.message_type=1,e.message_content=h(t);break;case 504:e.message_type=5,e.message_content=g(t);break;case 505:e.message_type=1,e.message_content=m(t);break;case 1007:e.message_type=3,e.message_content=v(t)}return e},_=function(e){var t=/((http|https):\/\/([0-9]|[A-Za-z]|\.|\/|\?|=|%|#|\+|&|:|_|\[|\]|\-)*)/gi;return e.replace(t,'<a class="link" target="_blank" href="$1">$1</a>')},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.split(d),o=(0,c["default"])(),r=a["default"].map(a["default"].compact(n),function(e){return o[e]?{itemtype:3,groupid:o[e].groupid,tag:o[e].tag,url:o[e].url}:{itemtype:1,text:_(i["default"].escapeHtml(e))}});return t?JSON.stringify(r):r},w=function(e){var t=a["default"].compact(e.split(l)),n=a["default"].map(t,function(e){return f.test(e)?{itemtype:2,url:e}:b(e,!1)});return JSON.stringify(a["default"].flatten(n))},T=function(e){e=JSON.parse(e);var t=a["default"].flatten(a["default"].map(e,function(e){return 1===e.itemtype?b(e.text,!1):e}));return JSON.stringify(t)},C=function(e){var t=JSON.parse(e);return JSON.stringify([{itemtype:2,groupid:t.emotionGroup,tag:t.emotionTag,url:t.url||"http://imapi.mogujie.com/phiz/index?p="+encodeURIComponent(e)+"&tag="}])},E=function(e){try{e.message_content=JSON.parse(e.message_content)}catch(t){return}switch(e.message_content.type){case 6:e.message_type=1001,e.message_content=JSON.stringify(e.message_content);break;case 7:e.message_type=1007,e.message_content=JSON.stringify(e.message_content);break;case 1e3:e.message_type=511,e.message_content=e.message_content.content}return e},M=function(e){var t=e,n=t.message_content,o=t.message_type;switch(o){case 1:e.message_content=w(n),e.message_type=505;break;case 100:e.message_type=503;break;case 3:e=E(e);break;case 5:e.message_content=C(n),e.message_type=505;break;case 501:e.message_content=b(n),e.message_type=505;break;case 505:e.message_content=T(n)}return e},x=function(e){e=M(e);var t=e,n=t.message_content,o=t.message_type;switch(o){case 501:return n;case 502:return"[\u56fe\u7247]";case 503:return"[\u8bed\u97f3]";case 504:return"[\u8868\u60c5]";case 505:var r=JSON.parse(n),i="";return a["default"].map(r,function(e){1===e.itemtype&&(i+=e.text),2===e.itemtype&&(i+="[\u56fe\u7247]"),3===e.itemtype&&(i+="[\u8868\u60c5]")}),i;default:return"[\u901a\u77e5]"}};t.formatMsg=y,t.formatLastMsg=x,t.parseMsg=M},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(7),i=n(18),s=n(11),a=o(s),u=n(10),c=o(u),l={},f=function(e,t){l[e]&&l[e].map(function(e){return e(t)})};(0,r.on)("getP2pMsg").then(function(e){var t=e.data.message,n=t.message_data,o=t.from_userid,r=t.to_userid;try{n=JSON.parse(n)}catch(s){return void console.error("getP2pMsg error:"+s)}var u=a["default"].get("loginUserId");if(r===u){var l=(0,i.getConvByUserId)(o);if(l){var d=l.conversation_id;switch(n.action){case"rateScore":var p={sender_id:o,conversation_id:d,timestamp:""+c["default"].sdkUtil.now(),client_message_id:c["default"].sdkUtil.getClientMsgId(),message_type:-1,message_content:n.data};f("rateScore",p)}}}}),t["default"]=function(e,t){l[e]||(l[e]=[]),l[e].push(t)},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(8),i=o(r),s=n(7),a=n(10),u=o(a),c=n(9),l={};t["default"]=function(e,t,n,o,r){return i["default"].promise(function(i,a){if(!e)return void a("no goodsId");var f=l[e];if(f)return void i(f);var d={goodsId:e,bid:t};n&&(d.channelId=n),o&&(d.fromType=o),r&&(d.activityId=r),(0,s.ajax)({url:(0,c.getUrl)("goodsApi"),data:d,type:"GET",dataType:"jsonp",jsonp:"callback"}).then(function(t){if(u["default"].urlToId(e),t&&1001===t.status.code)try{var n=t.result||{};u["default"].isHttps&&n.picUrl&&/http:\/\/s\d*\.mogucdn\.com/.test(n.picUrl)&&n.picUrl.replace(/^http:/i,"https:"),l[e]=n,i(n)}catch(o){console.log(o)}})})},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(1),c=o(u),l=n(24),f=o(l),d=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.handleClick=function(e){var t=e.currentTarget,n=t.getAttribute("id");o.props.active(n)},o.handleClose=function(e){e.stopPropagation();var t=e.currentTarget,n=t.parentNode.getAttribute("id");o.props.closeCb(n)},s=n,i(o,s)}return s(t,e),t.prototype.pushElement=function(){function e(e,t,n){t&&e.push(c["default"].cloneElement(t,a({key:e.length},n)))}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.className,n=e.focus,o=e.data,r=e.children,i=e.closeCb,s=e.id,a=o.avatar,u=o.bubble,l=o.time,d=o.title,p=o.Badges,h=o.subtitle,g=[];r&&g.push(c["default"].Children.toArray(r));var m=["item",t];return n&&m.push("active"),void 0!==a&&(m.push("item-avatar"),a?this.pushElement(g,c["default"].createElement(f["default"],{src:a,size:"36px",bubble:u})):this.pushElement(g,c["default"].createElement(f["default"],{size:"36px",bubble:u}))),d&&this.pushElement(g,c["default"].createElement("p",null,d)),void 0!==h&&this.pushElement(g,c["default"].createElement("p",{className:"min"},h||" ")),l&&this.pushElement(g,c["default"].createElement("span",{className:"update-time"},l)),p&&this.pushElement(g,c["default"].createElement("span",{className:"bubble item-bubble"},p)),i&&this.pushElement(g,c["default"].createElement("span",{className:"closeBtn",onClick:this.handleClose},"\xd7")),m=m.join(" "),c["default"].createElement("div",{className:m,id:s,onClick:this.handleClick},g)}return e}(),t}(c["default"].Component);d.propTypes={arrow:c["default"].PropTypes.bool,disabled:c["default"].PropTypes.bool,notify:c["default"].PropTypes.bool,children:c["default"].PropTypes.any,focus:c["default"].PropTypes.bool,active:c["default"].PropTypes.func,closeCb:c["default"].PropTypes.func,className:c["default"].PropTypes.string,data:c["default"].PropTypes.object,id:c["default"].PropTypes.string},d.defaultProps={arrow:!1,disabled:!1},t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(1),c=o(u),l=n(10),f=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return s(t,e),t.prototype.formatImgSrc=function(){function e(e){var t=e||"";return t&&t.indexOf(";")>0?t="//imapi.mogujie.com/mtalk/avatar?url="+t:l.isHttps&&/http:\/\/s\d*\.mogucdn\.com/.test(t)&&(t=t.replace(/^http:/i,"https:")),/^\/\w+/.test(t)&&(t="//s10.mogucdn.com"+t),t}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.src,n=e.bubble,o=this.props,r=o.backgroundColor,i=o.radius,s=o.color,u=o.size,l=o.style,f=o.className,d=["avatar",f].join(" "),p={borderRadius:i},h={width:u,height:u,backgroundColor:r,color:s};l&&(h=a(h,l));var g=this.formatImgSrc(t),m="";return n>0&&(m=c["default"].createElement("i",{className:"bubble"},n)),c["default"].createElement("div",{className:d,style:h},c["default"].createElement("img",{src:g,alt:t,style:p}),m)}return e}(),t}(c["default"].Component);f.propTypes={backgroundColor:c["default"].PropTypes.string,radius:c["default"].PropTypes.string,className:c["default"].PropTypes.string,color:c["default"].PropTypes.string,bubble:c["default"].PropTypes.number,size:c["default"].PropTypes.string,src:c["default"].PropTypes.string,style:c["default"].PropTypes.object},f.defaultProps={size:"32px",radius:"50%",backgroundColor:"#fff",color:"#fff"},t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return s(t,e),t.prototype.render=function(){function e(){var e=this.props,t=e.children,n=e.type,o=e.className,r=["list",o];return n&&r.push("list-"+n),r=r.join(" "),u["default"].createElement("div",{className:r},t)}return e}(),t}(u["default"].Component);c.propTypes={children:u["default"].PropTypes.node,type:u["default"].PropTypes.string,className:u["default"].PropTypes.string},t["default"]=c,e.exports=t["default"]},function(e,t){"use strict";function n(e,t,n){var o="";if(arguments.length<2?o="target error - target and name are both required":"object"!=("undefined"==typeof e?"undefined":r(e))?o="target error - target itself must be window object":"string"!=typeof t&&(o="target error - target name must be string type"),o)throw new Error(o);this.target=e,this.name=t,this.prefix=n}function o(e,t){this.targets={},this.name=e,this.listenFunc=[],this.prefix=t||i,this.initListen()}t.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="[PROJECT_NAME]",s="postMessage"in window;s?n.prototype.send=function(e){this.target.postMessage(this.prefix+"|"+this.name+"__Messenger__"+e,"*")}:n.prototype.send=function(e){var t=window.navigator[this.prefix+this.name];if("function"!=typeof t)throw new Error("target callback function is not defined");t(this.prefix+e,window)},o.prototype.addTarget=function(e,t){var o=new n(e,t,this.prefix);this.targets[t]=o},o.prototype.initListen=function(){var e=this,t=function(t){"object"==("undefined"==typeof t?"undefined":r(t))&&t.data&&(t=t.data);for(var n=t.split("__Messenger__"),t=n[1],o=n[0].split("|"),i=o[0],s=o[1],a=0;a<e.listenFunc.length;a++)i+s===e.prefix+e.name&&e.listenFunc[a](t)};s?"addEventListener"in document?window.addEventListener("message",t,!1):"attachEvent"in document&&window.attachEvent("onmessage",t):window.navigator[this.prefix+this.name]=t},o.prototype.listen=function(e){for(var t=0,n=this.listenFunc.length,o=!1;n>t;t++)if(this.listenFunc[t]==e){o=!0;break}o||this.listenFunc.push(e)},o.prototype.clear=function(){this.listenFunc=[]},o.prototype.send=function(e){var t,n=this.targets;for(t in n)n.hasOwnProperty(t)&&n[t].send(e)};var a,u;window.parent!==window.self&&(a=new o("im","ImFrame"),a.addTarget(window.parent,"Parent")),t["default"]={send:function(){function e(e){"object"==("undefined"==typeof a?"undefined":r(a))&&(u&&window.clearTimeout(u),u=window.setTimeout(function(){a.send(e)},300))}return e}()},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(6),l=n(20),f=n(28),d=o(f),p=n(11),h=o(p),g=n(30),m=o(g),v=n(38),y=o(v),_=n(10),b=o(_),w=n(14),T=o(w),C=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.sendMsg=function(e){var t=o.state.loginUserId,n=o.props.activeConvId,r={conversation_id:n,sender_id:t,push_name:"",client_message_id:b["default"].sdkUtil.getClientMsgId(),server_message_id:"0",message_type:e.message_type,message_content:JSON.stringify(e.message_content),timestamp:""+b["default"].sdkUtil.now(),client_type:h["default"].get("client_type")||3},i=JSON.parse(JSON.stringify(r));i.status=1,o.props.topConv(n,i),o.receiveMsg(n,i),r=(0,l.formatMsg)(r);var s=o.getMsgLoggerId(e.message_type),a=s[0],u=s[1],f=b["default"].now();(0,c.request)("sendMsg",{message:r,allocate_type:o.getallocateType()}).then(function(e){b["default"].elog(a,{time:b["default"].now()-f}),console.log("----send msg success",r,e),o.refreshMsg(i.client_message_id,2)})["catch"](function(e){b["default"].elog(u,{code:e.data.result,uid:h["default"].get("loginUserId")}),console.errror("send msg fail",r,e),o.refreshMsg(i.client_message_id,3)})},o.clearGoods=function(){o.setState({goodsInfo:null})},o.state={allChatConv:[],goodsInfo:null,loginUserId:h["default"].get("loginUserId")},o}return s(t,e),t.prototype.componentWillReceiveProps=function(){function e(e){var t=this,n=e.goods;"mogujie"===b["default"].getDomain()&&n&&this.props.goods!==n&&!this.state.goodsInfo&&(0,c.getGoods)(n.gId,n.shopId).then(function(e){e.convId=n.convId,e.id=n.gId,t.setState({goodsInfo:e})})}return e}(),t.prototype.getMsgLoggerId=function(){function e(e){var t=[];switch(e){case 505:t=["016100013","016100014"];
break;case 1:case 501:t=["016100011","016100012"];break;case 5:case 504:t=["016100015","016100016"];break;case 502:t=["016100008","016100009"]}return t}return e}(),t.prototype.getallocateType=function(){function e(){var e=h["default"].get("urlQuery");return e?e.allocateType:1}return e}(),t.prototype.refreshMsg=function(){function e(e,t){var n=this.props.activeConvId,o=this.state.allChatConv;T["default"].indexOf(o,n)>=0&&this.refs[n].refreshMsg(e,t)}return e}(),t.prototype.receiveMsg=function(){function e(e,t){var n=this.state.allChatConv;T["default"].indexOf(n,e)<0&&(n.push(e),this.setState({allChatConv:n})),this.refs[e].renderMsg(t)}return e}(),t.prototype.refreshHistory=function(){function e(){var e=this.props.activeConvId;this.refs[e]&&this.refs[e].getHisMsg(!0)}return e}(),t.prototype.render=function(){function e(){var e=this,t=this.props,n=t.activeConvId,o=t.notifyUserList,r=t.activeGroup,i=this.state,s=i.allChatConv,a=i.goodsInfo,l=i.loginUserId;n&&-1===s.indexOf(n)&&s.push(n);var f=s.map(function(t){return u["default"].createElement(y["default"],{key:"chat-"+t,ref:t,sendMsg:e.sendMsg,loginUserId:l,goodsInfo:a,clearGoods:e.clearGoods,hide:t!==n,activeConvId:t,notifyUserList:o,convInfo:(0,c.getConvByConvId)(t)})}),p=n?"show":"hidden";return p="chat-rooms "+p,r&&f.push(u["default"].createElement(d["default"],{activeGroup:r,loginUserId:l})),u["default"].createElement("div",{className:p},f,u["default"].createElement(m["default"],{sendMsg:this.sendMsg,className:r&&"none",activeConvId:n}))}return e}(),t}(u["default"].Component);C.propTypes={activeConvId:u["default"].PropTypes.string,activeConv:u["default"].PropTypes.object,activeGroup:u["default"].PropTypes.object,topConv:u["default"].PropTypes.func,goods:u["default"].PropTypes.object,notifyUserList:u["default"].PropTypes.func},t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(24),l=o(c),f=n(29),d=o(f),p=n(6),h=n(13),g=o(h),m=n(10),v=o(m),y=n(14),_=o(y),b=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.state={toastData:{show:!1,data:""},status:1,owner:null},o.handleClick=function(e){var t=o.props,n=t.activeGroup,r=t.loginUserId;e.preventDefault(),1===n.status&&(0,p.request)("addGroupMem",{group_id:n.group_id,invite_time:""+v["default"].now(),invite_user:"",user_id:[r]}).then(function(e){var t=e?e.data:{};t.group_id&&o.addGroupSucccess(t.group_id)},function(e){var t=e?e.data:{};1001===t.result?o.setState({status:2}):o.showToast("\u52a0\u5165\u7fa4\u5931\u8d25")})},o.showToast=function(e){o.setState({toastData:{show:!0,data:e,duration:5}})},o.hideToast=function(){o.setState({toastData:{show:!1,data:""}})},s=n,i(o,s)}return s(t,e),t.prototype.componentDidMount=function(){function e(){var e=this;(0,p.on)("memberAdded").then(function(t){console.warn(t),t=t?t.data:{};var n=e.props,o=n.activeGroup,r=n.loginUserId;o.group_id===t.group_id&&_["default"].indexOf(t.user_id,r)>=0&&e.addGroupSucccess(o.group_id)})}return e}(),t.prototype.componentWillReceiveProps=function(){function e(e){var t=e.activeGroup;this.setState({status:t.status})}return e}(),t.prototype.addGroupSucccess=function(){function e(e){var t=this;(0,p.createConv)(e,2).then(function(e){return e&&e.conversation_id?void(window.location.hash="#convId="+e.conversation_id):(t.showToast("\u521b\u5efa\u7fa4\u4f1a\u8bdd\u5931\u8d25"),void(window.location.hash=""))})}return e}(),t.prototype.render=function(){function e(){var e=this.props.activeGroup,t=this.state,n=t.status,o=t.toastData,r=this.state.owner,i="";r&&(i=u["default"].createElement("p",null,"\u7fa4\u4e3b:"));var s=1===n?"\u7533\u8bf7\u52a0\u5165\u7fa4":"\u7533\u8bf7\u5df2\u53d1\u51fa";return u["default"].createElement("div",{className:"chat-group-add"},u["default"].createElement(g["default"],{toastData:o,onClose:this.hideToast}),u["default"].createElement(l["default"],{src:e.group_avatar,size:"50"}),u["default"].createElement("div",{className:"group-box"},u["default"].createElement("p",null,e.group_name+"("+(e.group_member_count||e.member.length)+"\u4eba)"),i),u["default"].createElement("div",{className:"group-box group-desc"},u["default"].createElement("label",null,"\u7fa4\u4ecb\u7ecd"),u["default"].createElement("div",null,e.group_desc)),u["default"].createElement(d["default"],{type:"primary",width:"100%",onClick:this.handleClick},s))}return e}(),t}(u["default"].Component);b.propTypes={activeGroup:u["default"].PropTypes.object,loginUserId:u["default"].PropTypes.string},t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},c=n(1),l=o(c),f=function(e){function t(){return i(this,t),s(this,e.apply(this,arguments))}return a(t,e),t.prototype.render=function(){function e(){var e=this.props,t=e.type,n=e.size,o=e.width,i=e.height,s=e.disabled,a=e.inline,c=e.className,f=e.children,d=e.style,p=r(e,["type","size","width","height","disabled","inline","className","children","style"]),h=this.props.href?"a":"button",g=["btn",c],m={width:o,height:i};return d&&(m=u(m,d)),t&&g.push("btn-"+t),n&&g.push("btn-"+n),s&&g.push("disabled"),a&&g.push("btn-inline"),g=g.join(" "),l["default"].createElement(h,u({},p,{className:g,style:m}),f)}return e}(),t}(l["default"].Component);f.propTypes={disabled:l["default"].PropTypes.bool,inline:l["default"].PropTypes.bool,type:l["default"].PropTypes.string,size:l["default"].PropTypes.string,width:l["default"].PropTypes.string,height:l["default"].PropTypes.string,className:l["default"].PropTypes.string,href:l["default"].PropTypes.string,children:l["default"].PropTypes.any,style:l["default"].PropTypes.object},f.defaultProps={disabled:!1},t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(31),l=o(c),f=n(33),d=o(f),p=n(25),h=o(p),g=n(37),m=o(g),v=n(32),y=o(v),_=n(10),b=o(_),w=n(11),T=o(w),C=n(9),E=o(C),M=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.handleKeyPress=function(e){if(13===e.charCode||"Enter"===e.key){if(e.ctrlKey||e.shiftKey)return!1;if(e.preventDefault(),!window.navigator.onLine)return b["default"].showToast("\u53d1\u9001\u5931\u8d25\uff0c\u60a8\u7684\u7f51\u7edc\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");var t=o.refs.editor.formatContent();if(!t)return!1;o.props.sendMsg(t),o.refs.editor.clearUp()}},o.insertText=function(e){o.refs.editor.insertHtml(e)},o.insertImg=function(e,t){o.refs.editor.insertImg(e,t)},o.togglePhiz=function(e){o.refs.phiz.toggle(e)},o.uploadHandle=function(e){var t=e.currentTarget.files;if(t&&t[0]){var n=t[0].type;if(!/jpg|jpeg|gif|png/i.test(n))return;(0,y["default"])(t,null,function(e,t){if(!e)return b["default"].elog("016100010",{uid:T["default"].get("loginUserId"),code:t}),void b["default"].showToast("\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01");var n=e.url,r={message_type:502,message_content:{url:n}};o.props.sendMsg(r)})}},o.inputCache={},window.inputCache=o.inputCache,o.state={content:"",uploadUrl:E["default"].getUrl("imageUrl"),phizSHow:!1},o}return s(t,e),t.prototype.componentWillReceiveProps=function(){function e(e){var t=e.activeConvId;if(t!==this.props.activeConvId){var n=document.getElementById("editor");this.inputCache[this.props.activeConvId]=n?n.innerHTML:"";var o=this.inputCache[t]||"";this.setState({content:o})}}return e}(),t.prototype.shouldComponentUpdate=function(){function e(e){var t=e.activeConvId;return t!==this.props.activeConvId}return e}(),t.prototype.render=function(){function e(){var e=this.props.sendMsg,t=this.state,n=t.phizSHow,o=t.uploadUrl,r=t.content;return u["default"].createElement("div",{className:"chat-text",onKeyPress:this.handleKeyPress},u["default"].createElement(d["default"],{ref:"phiz",insertText:this.insertText,defaultdata:"",insertImg:this.insertImg,sendMsg:e,show:n}),u["default"].createElement(h["default"],{type:"horizontal"},u["default"].createElement("div",{onClick:this.togglePhiz,className:"item"},u["default"].createElement(m["default"],{value:"\u8868\u60c5",type:"happy"})),u["default"].createElement("div",{className:"item file-item"},u["default"].createElement("form",{target:"file_Iframe",id:"file_Form",action:o,method:"post",encType:"multipart/form-data"},u["default"].createElement("input",{type:"file",name:"image",className:"upload-file",onChange:this.uploadHandle})),u["default"].createElement(m["default"],{type:"image",value:"\u56fe\u7247"}))),u["default"].createElement(l["default"],{id:"editor",ref:"editor",activeInput:r}))}return e}(),t}(u["default"].Component);M.propTypes={value:u["default"].PropTypes.string,className:u["default"].PropTypes.string,sendMsg:u["default"].PropTypes.func,activeConvId:u["default"].PropTypes.string},M.defaultProps={activeConvId:""},t["default"]=M,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(32),l=o(c),f=n(10),d=o(f),p=n(11),h=o(p),g=n(2),m=function(){},v=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.state={focus:!1,content:""},o.handlePaste=function(e){var t=o,n=(e.originalEvent||e).clipboardData,r=n.types||[],i=r.indexOf("Files");if(i>=0){e.preventDefault();var s=n.items[i];if(s&&"file"===s.kind&&/^image\/|^(jpe?g|png|jpg|gif)$/.test(s.type)){var a=s.getAsFile();(0,l["default"])([a],"png",function(e,n){e||"undefined"===n||d["default"].elog("016100010",{uid:h["default"].get("loginUserId"),code:n}),t.insertImg(e.url)})}}else{var u=n.getData("text/plain");u&&(e.preventDefault(),o.insertHtml(u))}},s=n,i(o,s)}return s(t,e),t.prototype.formatContent=function(){function e(){for(var e=(0,g.findDOMNode)(this).childNodes,t=[],n=0;n<e.length;n++){var o=e[n];if(3===o.nodeType){var r=this._textContent(o);t.push({itemtype:1,text:r})}else if(1===o.nodeType&&"img"===o.nodeName.toLowerCase()){var i=o.getAttribute("data-face");i=JSON.parse(i),i&&i.tag?0===i.groupId||19===i.groupId?t.push({itemtype:1,text:i.tag}):t.push({itemtype:3,groupId:i.groupId,tag:i.tag,url:i.url}):/^http/i.test(o.src)&&t.push({itemtype:2,url:o.src})}}return 0!==t.length?{message_content:t,message_type:505}:void 0}return e}(),t.prototype.clearUp=function(){function e(){(0,g.findDOMNode)(this).innerHTML=""}return e}(),t.prototype.insertHtml=function(){function e(e){var t=(0,g.findDOMNode)(this);if(t.focus(),e){var n=!!window.ActiveXObject;if(document.execCommand&&!n)window.document.execCommand("insertHTML",!1,e);else if(window.getSelection){var o=window.getSelection(),r=o.getRangeAt(0);e=d["default"].escapeHtml(e),e=this.parseDom(e),r.insertNode(e),o.selectAllChildren(t),o.collapseToEnd()}else if(document.selection){var i=document.selection.createRange();i.moveToElementText(t),i.collapse(!1),i.pasteHTML(e)}else console.log(document.selection),this.parseDom(e),t.appendChild(this.parseDom(e))}}return e}(),t.prototype.parseDom=function(){function e(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}return e}(),t.prototype.componentWillReceiveProps=function(){function e(e){this.clearUp(),this.setState({content:e.activeInput})}return e}(),t.prototype._textContent=function(){function e(e){if(!e.textContent){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerText}return e.textContent}return e}(),t.prototype.insertImg=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=JSON.stringify(t);this.insertHtml("<img src='"+e+"' class='img-msg' data-face='"+n+"'>")}return e}(),t.prototype._handleTouchMove=function(){function e(e){e.preventDefault()}return e}(),t.prototype.handleFocus=function(){function e(e){var t=this;document.addEventListener("touchmove",this._handleTouchMove),setTimeout(function(){window.scrollTo(0,9999999),document.querySelector(".chat-main").addEventListener("click",t._handleBlur)}),this.props.focus&&this.props.focus(e)}return e}(),t.prototype._handleBlur=function(){function e(e){e.currentTarget.blur()}return e}(),t.prototype.handleBlur=function(){function e(e){var t=this;document.removeEventListener("touchmove",this._handleTouchMove),setTimeout(function(){document.querySelector(".chat-main").removeEventListener("click",t._handleBlur),document.querySelector(".chat-main").focus()}),this.props.blur()}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.className,n=(e.touchStart,e.blur,this.state.content),o=["editor",t].join(" ");return u["default"].createElement("div",{onBlur:this.handleBlur.bind(this),onFocus:this.handleFocus.bind(this),contentEditable:!0,className:o,onPaste:this.handlePaste,dangerouslySetInnerHTML:{__html:n}})}return e}(),t}(u["default"].Component);v.propTypes={className:u["default"].PropTypes.string,touchStart:u["default"].PropTypes.func,blur:u["default"].PropTypes.func},v.defaultProps={blur:m,focus:m,touchStart:m},t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=n(9),i=o(r),s=n(10),a=o(s);t["default"]=function(e,t,n){var o=i["default"].getUrl("imageUrl");if(!e||!e[0])return void(n&&n(null));if(!window.FormData)return void a["default"].showToast("\u60a8\u7684\u6d4f\u89c8\u5668\u7248\u672c\u592a\u4f4e\uff0c\u6682\u4e0d\u652f\u6301\u4e0a\u4f20\u56fe\u7247");var r=new FormData;t?r.append("image",e[0],"."+t):r.append("image",e[0]);var s=new XMLHttpRequest;s.addEventListener("load",function(e){var t=JSON.parse(e.target.responseText);n&&(t&&1001===t.status.code?n(t.result):n(null,t.status.code))},!1),s.addEventListener("error",function(e){console.error("pic upload error",e),n(null,"9999")}),s.withCredentials=!0,s.open("POST",o,!0),s.send(r)},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(34),l=o(c),f=n(35),d=o(f),p=n(36),h=o(p),g=n(6),m=n(9),v=o(m),y=n(10),_=o(y),b=n(14),w=o(b),T=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.tabChange=function(e){var t=o;return t.setState({curTab:e}),o.state.page[e]?"":void(0,g.ajax)({url:v["default"].getUrl("faceList"),type:"GET",data:{groupId:e},dataType:"jsonp",jsonp:"callback"}).then(function(n){if(n.status&&1001===n.status.code){var r=o._formatPage(t.state.page);r[e]=n.result,t.setState({page:r})}})},o.toggle=function(){o.setState({show:!o.state.show})},o.hide=function(){o.state.show&&o.setState({show:!1})},o.sendPhiz=function(e,t){var n=o.state.page[o.state.curTab][t];0===n.groupId||19===n.groupId?o.props.insertImg(n.url,n):o.props.sendMsg({message_content:{groupId:n.groupId,tag:n.tag,url:n.url},message_type:504}),o.hide()},o.state={tab:[],page:[],curTab:0,curIndex:0,show:!1},o}return s(t,e),t.prototype.componentDidMount=function(){function e(){var e=this;(0,g.ajax)({url:v["default"].getUrl("faceGroup"),type:"GET",data:{app:"meilishuo"===_["default"].getDomain()?3:1},dataType:"jsonp",jsonp:"callback"}).then(function(t){if(t.status&&1001===t.status.code){var n=e._formatPage(t.result.page);e.setState({page:n,tab:t.result.tab})}})}return e}(),t.prototype._formatPage=function(){function e(e){return y.isHttps?w["default"].map(e,function(e){return w["default"].map(e,function(e){var t=e.url||"";return y.isHttps&&/http:\/\/s\d*\.mogucdn\.com/.test(t)&&(e.url=t.replace(/^http:/i,"https:")),e})}):e}return e}(),t.prototype.componentWillUnmount=function(){function e(){}return e}(),t.prototype.render=function(){function e(){var e=this,t=this.props.className,n=this.state,o=n.tab,r=n.page,i=n.show,s=["phiz panel",t].join(" "),a=o.map(function(t,n){var o="";r[n]&&(o=r[n].map(function(e,t){return u["default"].createElement("img",{key:"g"+t,src:e.url,alt:e.emoji})}));var i=0===n?8:4;return u["default"].createElement(d["default"],{key:"tab"+n,src:t.imgUrl,text:t.name},u["default"].createElement(h["default"],{handleClick:e.sendPhiz,className:"grid-hover",cols:i,padding:10},o))});return u["default"].createElement("div",{className:s,style:{display:i?"block":"none"}},u["default"].createElement(l["default"],{tabChange:this.tabChange},a))}return e}(),t}(u["default"].Component);T.propTypes={children:u["default"].PropTypes.any,insertImg:u["default"].PropTypes.func,className:u["default"].PropTypes.string,sendMsg:u["default"].PropTypes.func},T.defaultProps={data:[]},t["default"]=T,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(10),l=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.state={selectedIndex:0},o.handleTabClick=function(e){var t=e.currentTarget,n=t.offsetWidth,r=t.tabIndex;if(o.state.selectedIndex===r)return"";var i=n*(r-1);r<=o.props.PageCount/2&&(i=0);var s=o.getTabCount()-o.props.PageCount/2-2;r>s&&(i=s*n),t.parentElement.style.marginLeft=-i+"px",o.setState({selectedIndex:t.tabIndex}),o.props.tabChange(r)},s=n,i(o,s)}return s(t,e),t.prototype.getTabs=function(){function e(){var e=[];return u["default"].Children.forEach(this.props.children,function(t){u["default"].isValidElement(t)&&e.push(t)}),e}return e}(),t.prototype.getTabCount=function(){function e(){return this.getTabs().length}return e}(),t.prototype.render=function(){function e(){var e=this,t=this.props,n=t.className,o=t.PageCount,r=["tabs",n].join(" "),i=this.state.selectedIndex,s=[],a=this.getTabCount(),l=100/a,f=100*a/o,d=this.getTabs().map(function(t,n){s.push(u["default"].cloneElement(t,{key:n,className:"tabs-panel "+(i===n?"selected":"")}));var o=t.props.text;return t.props.src&&(c.isHttps&&/http:\/\/s\d*\.mogucdn\.com/.test(url)&&t.props.src.replace(/^http:/i,"https:"),o=u["default"].createElement("img",{src:t.props.src,alt:""})),u["default"].createElement("div",{className:"tabs-item "+(i===n?"selected":""),key:n,tabIndex:n,style:{width:l+"%"},onClick:e.handleTabClick},o)});return u["default"].createElement("div",{className:r},u["default"].createElement("div",{className:"tabs-head",style:{width:f+"%"}},d),s)}return e}(),t}(u["default"].Component);l.propTypes={PageCount:u["default"].PropTypes.number,children:u["default"].PropTypes.any,tabChange:u["default"].PropTypes.func,className:u["default"].PropTypes.string},l.defaultProps={tabChange:function(){function e(){}return e}(),PageCount:4},t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.handleChange=function(){},s=n,i(o,s)}return s(t,e),t.prototype.render=function(){function e(){var e=this.props,t=e.className,n=e.children;return u["default"].createElement("div",{className:t},n)}return e}(),t}(u["default"].Component);c.propTypes={className:u["default"].PropTypes.string,children:u["default"].PropTypes.any},c.defaultProps={},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.handleTabClick=function(e){var t=e.currentTarget.getAttribute("data-index");o.props.handleClick(e,t)},s=n,i(o,s)}return s(t,e),t.prototype.render=function(){function e(){var e=this,t=this.props,n=t.className,o=t.children,r=t.padding,i=t.cols,s=["grid",n],a=100/i,c=u["default"].Children.map(o,function(t,n){return u["default"].createElement("div",{key:n,className:"grid-item","data-index":n,style:{padding:r/2,width:a+"%"},onClick:e.handleTabClick},t)});return s=s.join(" "),u["default"].createElement("div",{className:s},c)}return e}(),t}(u["default"].Component);c.propTypes={cols:u["default"].PropTypes.number,handleClick:u["default"].PropTypes.func,className:u["default"].PropTypes.string,children:u["default"].PropTypes.any,padding:u["default"].PropTypes.number},c.defaultProps={handleClick:function(){function e(){}return e}(),padding:0,cols:4},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.handleMouseLeave=function(){void 0!==o.props.hoverColor&&o.setState({hovered:!1}),o.props.onMouseLeave&&o.props.onMouseLeave(event)},o.handleMouseEnter=function(){void 0!==o.props.hoverColor&&o.setState({hovered:!0}),o.props.onMouseEnter&&o.props.onMouseEnter(event)},s=n,i(o,s)}return s(t,e),t.prototype.render=function(){function e(){var e=this.props,t=e.className,n=e.type,o=e.value,r=e.style,i=[t,"icon"].join(" "),s="icon-"+n;return u["default"].createElement("span",{className:i,style:r},u["default"].createElement("i",{className:s,onMouseLeave:this.handleMouseLeave,onMouseEnter:this.handleMouseEnter}),o)}return e}(),t}(u["default"].Component);c.propTypes={children:u["default"].PropTypes.node,color:u["default"].PropTypes.string,hoverColor:u["default"].PropTypes.string,onMouseEnter:u["default"].PropTypes.func,onMouseLeave:u["default"].PropTypes.func,className:u["default"].PropTypes.string,type:u["default"].PropTypes.string,style:u["default"].PropTypes.object,value:u["default"].PropTypes.any},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(1),c=o(u),l=n(25),f=o(l),d=n(39),p=o(d),h=n(6),g=n(11),m=o(g),v=n(9),y=n(20),_=n(2),b=n(10),w=o(b),T=n(14),C=o(T),E=function(e){function t(n){r(this,t);var o=i(this,e.call(this,n));return o.getHisMsg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.historySize;if(!o.lock){o.lock=!0;var n=o.state,r=n.messages,i=n.end,s=o.props,a=s.activeConvId,u=s.convInfo;if(a){var c=[],l=o.minMsgId,f=0;e&&(l=Math.pow(2,31),f=o.maxMsgId);var d=w["default"].now();(0,h.request)("getHistoryMsg",{conversation_id:""+a,max_conversation_message_id:""+l,min_conversation_message_id:""+f,count:t}).then(function(t){if(t.data){w["default"].elog("016100019",{time:w["default"].now()-d});var n=0;e&&r.length>0&&(n=C["default"].last(r).timestamp);var s=C["default"].chain(t.data.message).filter(function(e){return!!e.message_content}).map(function(e){var t=o.formatMsg(e,n);return n=e.timestamp,c.push(e.sender_id),t}).flatten().value();console.log("---------get history msg success-----------",s),(o.minMsgId<=1||0===s.length)&&(i=!0),r=r.concat(s),r=C["default"].chain(r).sortBy(function(e){return Math.abs(e.timestamp)}).uniq(!1,function(e){return e.client_message_id}).value(),o.lock=!1;var a=(0,_.findDOMNode)(o);if(o.oldHeight=a.scrollHeight,c=C["default"].compact(C["default"].union(c)),c.length>0&&(2===u.entity_type?(0,h.getUser)(c).then(function(e){r=C["default"].map(r,function(t){return e[t.sender_id]&&(t.user=e[t.sender_id]),t}),o.setState({messages:r})}):!function(){var e=m["default"].get("loginUserId"),t=u.entity_id;c=[e,t],(0,h.getUser)(c).then(function(n){r=C["default"].map(r,function(o){return o.sender_id===e?o.user=n[e]:o.user=n[t],o}),o.setState({messages:r})})}()),o.setState({messages:r,end:i}),e)o.scrollBottom();else{var l=a.scrollHeight;a.scrollTop=l-o.oldHeight}}})["catch"](function(e){w["default"].elog("016100020",{code:e.data.result,uid:o.props.loginUserId,convid:a}),window.location.hash="",console.error("get his history msg fail",e)})}}},o.historyHandle=function(){o.getHisMsg()},o.scrollHandle=function(e){var t=e.currentTarget||(0,_.findDOMNode)(o),n=t.clientHeight,r=t.scrollHeight-t.scrollTop;return 10>r-n?(o.state.newMsg&&o.setState({newMsg:!1}),void(o.hasUnread&&(o.props.notifyUserList(o.props.activeConvId),o.hasUnread=!1))):void(o.state.end||t.scrollTop<=100&&o.getHisMsg())},o.mousewheelHandle=function(e){var t=e.wheelDelta||-e.detail;if(t=Math.max(-1,Math.min(1,t)),1===t){var n=(0,_.findDOMNode)(o);o.state.end||o.getHisMsg(),w["default"].sdkUtil.off(n,"mousewheel",o.mousewheelHandle)}},o.gotoBottom=function(e){e&&e.preventDefault(),setTimeout(function(){var e=(0,_.findDOMNode)(o);e.scrollTop=e.scrollHeight-e.clientHeight,o.setState({newMsg:!1}),o.props.hide||o.props.notifyUserList(o.props.activeConvId)},10)},o.sendGoodsMsg=function(){var e=o.props,t=e.sendMsg,n=e.goodsInfo;console.log(n);var r={message_type:1007,message_content:{id:n.id,picurl:n.picUrl,title:n.title,price:n.price}};return t(r),!1},o.lock=!1,o.hasUnread=!1,o.state={messages:[],end:!1,newMsg:!1,loginUserId:m["default"].get("loginUserId")},o}return s(t,e),t.prototype.componentDidMount=function(){function e(){this.maxMsgId=0,this.minMsgId=Math.pow(2,31);var e=(0,_.findDOMNode)(this),t=this.state.messages;t.length<v.firstHistory&&this.getHisMsg(!0,v.firstHistory),w["default"].sdkUtil.on(e,"scroll",C["default"].throttle(this.scrollHandle,80)),w["default"].sdkUtil.on(e,"mousewheel",this.mousewheelHandle)}return e}(),t.prototype.componentWillUnmount=function(){function e(){var e=(0,_.findDOMNode)(this);w["default"].sdkUtil.off(e,"scroll",this.scrollHandle)}return e}(),t.prototype.componentWillUpdate=function(){function e(e){var t=e.hide;!t&&this.hasUnread&&(this.scrollBottom(),this.hasUnread=!1)}return e}(),t.prototype.refreshMsg=function(){function e(e,t){var n=this.state.messages;n=C["default"].map(n,function(n){return n.client_message_id===e&&(n.status=t),n}),this.setState({
messages:n})}return e}(),t.prototype.formatMsg=function(){function e(e,t){var n=this.props.loginUserId,o=(0,y.parseMsg)(e);if(o.owner=o.sender_id===n?"me":"other",-1===o.message_type){var r=this.state.messages[this.state.messages.length-1];r&&(o=a(o,{client_message_id:r.client_message_id+".2",conversation_message_id:r.client_message_id+".2"}))}var i=parseInt(o.conversation_message_id,10);return i<this.minMsgId&&(this.minMsgId=i),i>this.maxMsgId&&(this.maxMsgId=i),t>0&&e.timestamp-t>=v.diffTime?[{conversation_id:e.conversation_id,client_message_id:e.client_message_id+".1",conversation_message_id:e.conversation_message_id+".1",message_content:w["default"].dayTime(e.timestamp),message_type:511,user:{},timestamp:t},o]:o}return e}(),t.prototype.scrollBottom=function(){function e(){var e=(0,_.findDOMNode)(this);this.hasUnread&&!this.props.hide&&e.scrollTop<=e.scrollHeight-2.5*e.clientHeight?this.setState({newMsg:!0}):this.gotoBottom()}return e}(),t.prototype.renderMsg=function(){function e(e){var t=this;this.hasUnread=!0;var n=e.sender_id;n&&(0,h.getUser)([n]).then(function(o){e.user=o[n]||{};var r=t.state.messages,i=C["default"].last(r)||{},s=t.formatMsg(e,i.timestamp);s instanceof Array?r=r.concat(s):r.push(s),t.setState({messages:r}),t.props.loginUserId===n&&t.gotoBottom()})}return e}(),t.prototype.renderGoods=function(){function e(){var e=this.props,t=e.goodsInfo,n=e.activeConvId;return t&&t.convId===n?c["default"].createElement("div",{className:"goods-box"},c["default"].createElement("div",{className:"goods-msg"},c["default"].createElement("img",{src:t.picUrl,alt:""}),c["default"].createElement("p",{className:"title"},t.title),c["default"].createElement("a",{className:"btn btn-clear",onClick:this.props.clearGoods}),c["default"].createElement("p",{className:"price"},"\xa5",t.price,c["default"].createElement("a",{onClick:this.sendGoodsMsg,className:"btn btn-sm"},"\u53d1\u9001\u94fe\u63a5")))):""}return e}(),t.prototype.render=function(){function e(){var e=this.state,t=e.messages,n=e.newMsg,o=e.end,r=this.props,i=r.activeConvId,s=r.hide,a=s?"msglist-hidden":"msglist-active",u=this.renderGoods(),l=t.map(function(e){return c["default"].createElement(p["default"],{key:e.client_message_id,user:e.user,status:e.status,content:e.message_content,convId:i,msgId:e.conversation_message_id,type:e.message_type,owner:e.owner})}),d="";t.length?d=o?c["default"].createElement("span",{className:"history-btn"},"\u6ca1\u6709\u66f4\u591a\u6d88\u606f"):c["default"].createElement("a",{onClick:this.historyHandle,className:"history-btn"},"\u67e5\u770b\u5386\u53f2\u804a\u5929\u8bb0\u5f55"):o&&(d=c["default"].createElement("span",{className:"history-btn"},"\u6682\u65e0\u804a\u5929\u6d88\u606f"));var h={display:n?"block":"none"};return c["default"].createElement(f["default"],{type:"msg",key:i,id:i,className:a},u,d,l,c["default"].createElement("a",{onClick:this.gotoBottom,className:"new-msg",style:h},"\u65b0\u6d88\u606f"))}return e}(),t}(u.Component);E.propTypes={activeConvId:c["default"].PropTypes.string,notifyUserList:c["default"].PropTypes.func,loginUserId:c["default"].PropTypes.string,goodsInfo:c["default"].PropTypes.object,clearGoods:c["default"].PropTypes.func,sendMsg:c["default"].PropTypes.func,hide:c["default"].PropTypes.bool,convInfo:c["default"].PropTypes.object},t["default"]=E,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(1),c=o(u),l=n(24),f=o(l),d=n(40),p=o(d),h=n(41),g=o(h),m=n(9),v=o(m),y=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return s(t,e),t.prototype.pushElement=function(){function e(e,t,n){t&&e.push(c["default"].cloneElement(t,a({key:e.length},n)))}return e}(),t.prototype.mixMsg=function(){function e(e){var t=JSON.parse(e),n=[];return t.forEach(function(e,t){var o,r;switch(e.itemtype){case 1:n.push(c["default"].createElement("span",{dangerouslySetInnerHTML:{__html:e.text},key:t}));break;case 2:n.push(c["default"].createElement(p["default"],(o={key:t,src:e.url},o.key=t,o)));break;case 3:n.push(c["default"].createElement(p["default"],(r={key:t,src:e.url},r.key=t,r)))}}),n}return e}(),t.prototype.goodsMsg=function(){function e(e){e=JSON.parse(e);var t=v["default"].getUrl("goodsUrl");return c["default"].createElement("div",{className:"goods-msg",ref:""},c["default"].createElement("a",{target:"_blank",href:""+t+e.id},c["default"].createElement("img",{src:e.picurl,alt:""}),c["default"].createElement("p",{className:"title"},e.title),c["default"].createElement("p",{className:"price"},"\xa5",e.price)))}return e}(),t.prototype.joinGroupMsg=function(){function e(e){var t=this.props.user,n=t.avatar,o=t.name;return c["default"].createElement("div",{className:"join-group-msg"},c["default"].createElement("p",null,"\u9080\u8bf7\u4f60\u52a0\u5165\u7fa4\u804a"),c["default"].createElement("div",null,c["default"].createElement("div",null,c["default"].createElement("img",{src:n,alt:o})),c["default"].createElement("div",null,o+"\u9080\u8bf7\u4f60\u52a0\u5165\u7fa4\u804a'"+e.groupname+"'\uff0c\u8fdb\u5165\u67e5\u770b\u8be6\u60c5\u3002")))}return e}(),t.prototype.emotionMsg=function(){function e(e){return e=JSON.parse(e),e.url?e.url:(e={emotionGroup:e.groupId,emotionTag:e.tag},e=JSON.stringify(e),"http://imapi.mogujie.com/phiz/index?p="+encodeURIComponent(e))}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.content,n=e.type,o=e.owner,r=e.user,i=e.children,s=e.convId,a="me"===o?"msg msg-mine":"msg",u=[i],l=r.avatar?c["default"].createElement(f["default"],{"data-uid":r.entity_id,src:r.avatar}):c["default"].createElement(f["default"],null);switch(n){case 501:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context",dangerouslySetInnerHTML:{__html:t}}));break;case 502:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context"},c["default"].createElement(p["default"],{src:JSON.parse(t).url})));break;case 504:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context"},c["default"].createElement(p["default"],{src:this.emotionMsg(t)})));break;case 505:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context"},this.mixMsg(t)));break;case 511:case 512:case 513:case 514:case-2:this.pushElement(u,c["default"].createElement("div",{style:{textAlign:"center"}},c["default"].createElement("span",{className:"msg-notice",dangerouslySetInnerHTML:{__html:t}})));break;case 1007:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context"},this.goodsMsg(t)));break;case-1:this.pushElement(u,c["default"].createElement(g["default"],{content:t,convId:s}));break;default:this.pushElement(u,l),this.pushElement(u,c["default"].createElement("div",{className:"msg-context","data-type":n},"[ \u6682\u4e0d\u652f\u6301\u8be5\u683c\u5f0f\u6d88\u606f ]"))}return c["default"].createElement("div",{className:a},u)}return e}(),t}(c["default"].Component);y.propTypes={owner:c["default"].PropTypes.string,type:c["default"].PropTypes.number,content:c["default"].PropTypes.string,status:c["default"].PropTypes.number,user:c["default"].PropTypes.any,className:c["default"].PropTypes.string,children:c["default"].PropTypes.node,convId:c["default"].PropTypes.string},y.defaultProps={activeMsg:[],owner:"other",user:{}},t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(10),l=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return s(t,e),t.prototype.formatPic=function(){function e(){var e=this.props.src,t=this.props,n=t.maxWidth,o=t.maxHeight;if("string"==typeof e){if(/\/phiz\?p=/.test(e))return{width:200,height:200,src:e};c.isHttps&&/http:\/\/s\d*\.mogucdn\.com/.test(e)&&(e=e.replace(/^http:/i,"https:"));var r=e.match(/_\d*x\d*\.(jpg|gif|png)$/gi);if(!r||0===r.length)return{width:n,height:o,src:e};var i=r[0].substr(1);i=i.split(/[.|x]/);var s=i[0],a=i[1],u=i[2];return s>n?(a=Math.round(a*n/s),s=n):a>o&&(s=Math.round(s*o/a),a=o),e=e+"_320x999."+u,{width:s,height:a,src:e}}}return e}(),t.prototype.render=function(){function e(){var e=this.props.src,t=this.props.className,n=["msg-img",t].join(" "),o=this.formatPic(e);return u["default"].createElement("div",{className:n},u["default"].createElement("a",{target:"_blank",className:"J-img",href:e},u["default"].createElement("img",{src:o.src,alt:e,width:o.width,height:o.height})))}return e}(),t}(u["default"].Component);l.propTypes={src:u["default"].PropTypes.string,link:u["default"].PropTypes.string,maxWidth:u["default"].PropTypes.number,maxHeight:u["default"].PropTypes.number,context:u["default"].PropTypes.string,children:u["default"].PropTypes.node,className:u["default"].PropTypes.string},l.defaultProps={maxWidth:200,maxHeight:300,src:""},t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(11),u=o(a),c=n(9),l=o(c),f=n(42),d=o(f),p=n(6),h=["\u975e\u5e38\u4e0d\u6ee1\u610f","\u4e0d\u6ee1\u610f","\u4e00\u822c","\u6ee1\u610f","\u975e\u5e38\u6ee1\u610f"],g=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,c=Array(a),l=0;a>l;l++)c[l]=arguments[l];return n=o=i(this,e.call.apply(e,[this].concat(c))),o.btnClick=function(e){var t=e.currentTarget,n=d["default"].closest(t,".new-score-msg");if(!d["default"].hasClass(n,"rated")){for(var o=t.getAttribute("data-score"),r=n.querySelectorAll(".rate-btn"),i=0;3>i;i++)r[i]!==t?d["default"].removeClass(r[i],"choosed"):d["default"].addClass(r[i],"choosed");n.setAttribute("data-final-score",o)}},o.btnSubmit=function(e){e.preventDefault();var t=e.currentTarget,n=d["default"].closest(t,".new-score-msg");if(!d["default"].hasClass(n,"rated")){var o=n.getAttribute("data-final-score"),r=n.getAttribute("data-scoreid");(0,p.rateScore)(u["default"].get("loginUserId"),r,o),d["default"].addClass(n,"rated"),t.innerHTML="\u5df2\u63d0\u4ea4"}},o.starEnter=function(e){e.preventDefault();var t=e.currentTarget,n=t.getAttribute("data-score"),o=d["default"].closest(t,".score-msg");if(!d["default"].hasClass(o,"added")){for(var r=o.querySelectorAll(".star"),i=0;5>i;i++)n>=i+1?d["default"].addClass(r[i],"star-hover"):d["default"].removeClass(r[i],"star-hover");o.querySelector(".score-tip").innerHTML=h[n-1]}},o.starOut=function(e){e.preventDefault();var t=e.currentTarget,n=t.getAttribute("data-score"),o=d["default"].closest(t,".score-msg");if(!d["default"].hasClass(o,"added")){for(var r=o.querySelectorAll(".star"),i=0;n>i;i++)d["default"].removeClass(r[i],"star-hover");o.querySelector(".score-tip").innerHTML=""}},o.addScore=function(e){var t=e.currentTarget,n=t.getAttribute("data-score"),o=d["default"].closest(t,".score-msg");if(!d["default"].hasClass(o,"rated")){for(var r=o.querySelectorAll(".star"),i=0;5>i;i++)n>=i+1?d["default"].addClass(r[i],"star-hover"):d["default"].removeClass(r[i],"star-hover");o.querySelector(".score-tip").innerHTML=h[n-1],o.setAttribute("data-final-score",n),d["default"].addClass(o,"added")}},o.starSubmit=function(e){e.preventDefault();var t=e.currentTarget,n=d["default"].closest(t,".score-msg");if(d["default"].hasClass(n,"added")&&!d["default"].hasClass(n,"rated")){var o=n.getAttribute("data-scoreid"),r=n.getAttribute("data-final-score");(0,p.rateScore)(u["default"].get("loginUserId"),o,r),d["default"].addClass(n,"rated"),t.innerHTML="\u5df2\u63d0\u4ea4"}},s=n,i(o,s)}return s(t,e),t.prototype._scoreMsg=function(){function e(e){for(var t=[],n=0;5>n;n++)t.push(React.createElement("a",{key:n,"data-score":n+1,"data-tip":h[n],onClick:this.addScore,onMouseEnter:this.starEnter,onMouseOut:this.starOut,className:"star"}));return React.createElement("div",{className:"score-msg","data-scoreid":e.scoreid,"data-final-score":5},React.createElement("p",null,"\u9ebb\u70e6\u83c7\u51c9\u5bf9\u672c\u6b21\u670d\u52a1\u8fdb\u884c\u8bc4\u4ef7"),React.createElement("div",{className:"score-data clearfix"},React.createElement("div",{className:"rate"},t,React.createElement("span",{className:"score-tip"})),React.createElement("a",{onClick:this.starSubmit,className:"score-submit",href:""},"\u63d0\u4ea4")))}return e}(),t.prototype._newScoreMsg=function(){function e(e){for(var t=[],n=0;3>n;n++){var o="rate-btn";2===n&&(o="rate-btn choosed"),t.push(React.createElement("div",{key:n,"data-score":n+6,onClick:this.btnClick,className:o},h[n+1]))}return React.createElement("div",{className:"new-score-msg","data-scoreid":e.scoreid,"data-final-score":8},React.createElement("p",null,"\u9ebb\u70e6\u83c7\u51c9\u5bf9\u672c\u6b21\u670d\u52a1\u8fdb\u884c\u8bc4\u4ef7"),React.createElement("div",{className:"score-data clearfix"},React.createElement("div",{className:"rate"},t),React.createElement("a",{onClick:this.btnSubmit,className:"score-submit",href:""},"\u63d0\u4ea4")))}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.content,n=e.convId,o=(0,p.getConvByConvId)(n).entity_id;return-1!==l["default"].offcial.indexOf(o)?this._newScoreMsg(t):this._scoreMsg(t)}return e}(),t}(React.Component);g.propTypes={content:React.PropTypes.object,userId:React.PropTypes.string,children:React.PropTypes.node,convId:React.PropTypes.string},t["default"]=g,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var n=/\s+/;t["default"]={closest:function(){function e(e,t){for(var n=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1};e;){if(n.call(e,t))return e;e=e.parentElement}return null}return e}(),addClass:function(){function e(e,t){var o=e.getAttribute("class").split(n);t=t.split(n),t.forEach(function(e){e&&-1===o.indexOf(e)&&o.push(e)}),e.setAttribute("class",o.join(" "))}return e}(),removeClass:function(){function e(e,t){if(!t)return e.setAttribute("class","");var o=e.getAttribute("class").split(n);t=t.split(n);var r=[];o.forEach(function(e){e&&-1===t.indexOf(e)&&r.push(e)}),e.setAttribute("class",r.join(" "))}return e}(),hasClass:function(){function e(e,t){var o=e.getAttribute("class").split(n);return-1!==o.indexOf(t)}return e}(),toggleClass:function(){function e(e,t){if(e.classList)e.classList.toggle(t);else{var o=e.className.split(n),r=o.indexOf(t);-1!==r?o.splice(r,1):o.push(t),e.className=o.join(" ")}}return e}()},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=n(10),s=o(i),a=n(6),u=n(9),c=o(u),l=n(11),f=o(l),d=function(){},p=["orderRefund","orderDetail"],h=function(e){return(0,a.ajax)({url:c["default"].getUrl("webim")+"/jsonp/getshopowner/1",data:{shopId:e},type:"GET",dataType:"jsonp",jsonp:"callback"})},g=function(){var e=s["default"].queryString(),t=s["default"].queryString(window.location.hash);return t=r(e,t),t.fromPage&&p.indexOf(t.fromPage)>=0&&(t.allocateType=2),t.allocatetype&&(t.allocateType=t.allocatetype),(t.userId||t.shopId)&&(t.allocateType=parseInt(t.allocateType)||1,f["default"].set("urlQuery",t,!0)),t},m=function(e){e=decodeURIComponent(e),e=e.replace(/^detail\//i,"");var t=e.split("/"),n=t[0],o=t[1],r=t[2],i=r?r.replace(/^g/,""):null;if("group"===n)return void d({groupId:o,goodsId:i});if("user"===n)return void d({userId:o,goodsId:i});if("conversation"===n)return void d({convId:o,goodsId:i});if(!/^b/.test(o))return void d({userId:o,goodsId:i});var s=o.replace(/^b/,"").replace(/#\d*$/,"");h(s).then(function(e){if(e.success&&e.data){var t=e.data.userId;d({userId:t,shopId:s,goodsId:i})}})},v=function(){var e=window.location.hash.split("#")[1]||"";if(/^(chat|group|detail)\//i.test(e))return void m(e);var t=g();t.shopId&&!t.userId&&h(t.shopId).then(function(e){e.success&&e.data&&(t.userId=e.data.userId,d(t))}),d(t)};t["default"]=function(e){d=e,v()},e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(24),l=o(c),f=n(26),d=o(f),p=function(e){function t(){var n,o,s;r(this,t);for(var a=arguments.length,u=Array(a),c=0;a>c;c++)u[c]=arguments[c];return n=o=i(this,e.call.apply(e,[this].concat(u))),o.handleClick=function(){d["default"].send(JSON.stringify({code:1002,data:null}))},s=n,i(o,s)}return s(t,e),t.prototype.render=function(){function e(){var e=this.props.activeConv,t=e.avatar,n=e.name,o="";return n&&(o=u["default"].createElement(l["default"],{size:"50px",src:t})),u["default"].createElement("div",{className:"navbar chat-header"},o,u["default"].createElement("span",{dangerouslySetInnerHTML:{__html:n}}),u["default"].createElement("span",{onClick:this.handleClick,className:"close-frame"}))}return e}(),t}(u["default"].Component);p.propTypes={activeConv:u["default"].PropTypes.object,activeConvId:u["default"].PropTypes.string,children:u["default"].PropTypes.any},p.defaultProps={activeConv:{}},t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=n(1),u=o(a),c=n(44),l=o(c),f=function(e){function t(){return r(this,t),i(this,e.apply(this,arguments))}return s(t,e),t.prototype.refresh=function(){function e(e){e.preventDefault(),location.reload()}return e}(),t.prototype.render=function(){function e(){var e=this.props,t=e.data,n=e.showBtn,o="";return n&&(o=u["default"].createElement("a",{onClick:this.refresh},"\u91cd\u65b0\u8fde\u63a5")),u["default"].createElement("div",{className:"wrap"},u["default"].createElement(l["default"],null),u["default"].createElement("div",{className:"chat-body"},u["default"].createElement("div",{className:"login-need"},t,o)))}return e}(),t}(a.Component);f.propTypes={data:a.PropTypes.string},f.defaultProps={data:"\u4f60\u6ca1\u6709\u767b\u5f55,\u8bf7\u5148\u767b\u5f55\u540e\u91cd\u65b0\u5c1d\u8bd5"},t["default"]=f,e.exports=t["default"]}])});